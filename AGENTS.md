# Guidelines for Codex agents

- Always run `make fmt` and `make test` before committing.
- Use Tailwind CSS utilities when updating templates, but keep Bootstrap components unless instructed otherwise.
- Do not modify models or database migrations unless explicitly requested.
- The notes blueprint exposes both `notes.detail` and `notes.view_note` for `/notes/<id>`.
- Merge duplicated `DOMContentLoaded` listeners into a single entry point in `main.js`.
- All `<form method="post">` must import `components/csrf.html` and call
  `csrf_field()` immediately after the `<form>` tag.
- Nunca hacer CREATE TYPE sin comprobar si el tipo ya existe; usa IF NOT EXISTS o checkfirst=True.
- Se corrigió la barra de navegación fija añadiendo padding global y mejorando el menú móvil (PR navbar fixes).
- Se ajustó el padding global mediante CSS en el body y se agregó z-index al navbar para evitar que tape el contenido.
- Se mejoró el cierre del menú móvil y se fijó la altura del navbar (PR navbar fixes 2).
- Se cierra el menú móvil al redimensionar la pantalla (PR navbar fixes 3).
- Se movió el padding-top global al archivo style.css y se eliminó el bloque de
  estilos embebidos en base.html (PR navbar fixes 4).
- Se ajustó el `main` con padding-top en móviles y se quitó en pantallas
  mayores (PR navbar fixes 5).
- Se agregó margen superior al `main` solo en escritorio con CSS
  (`@media (min-width: 992px)`)
- Se oculta `#mobileMenuOverlay` en escritorio y se ajusta el
  listener de redimensionado a 992px (PR overlay fix).
- Se establece `height` y `width` en 0 para `#mobileMenuOverlay` en
  escritorio y se asegura que `closeMenu()` añada `tw-hidden` (PR overlay fix 2).
- Se corrige la clase inicial de `#navLinks` para mostrarse horizontal en
  escritorio y se evita abrir el menú móvil en pantallas grandes
  (PR navbar desktop fix).
- Se establece `z-index: -1` y `position: static` para `#mobileMenuOverlay`
  en escritorio, previniendo que bloquee el contenido (PR overlay fix 3).
- Se asegura que `#navLinks` se coloque en `#desktopNavContainer` al cargar la
  página y se oculta `#mobileMenuPanel` en escritorio (PR navbar panel fix).
- Se fuerzan `display: none` y `pointer-events: none` para `#mobileMenuOverlay`
  y `#mobileMenuPanel` en escritorio, actualizando `main.js` para aplicar estos
  estilos al cargar la página y al cerrar el menú (PR overlay hide complete).

- Se agregó "navbar_crunevo_fixed.html" como ejemplo de navbar fijo con menú móvil.
- Navbar migrado completamente a Bootstrap sin Tailwind ni overlay. Se eliminó el script de Tailwind y se simplificó main.js (PR bootstrap-only navbar).
- Implemented Tabler-based admin dashboard with new templates and blueprint enforcement.
- Fixed PDF upload to Cloudinary storing URL and adjusted templates (PR pdf-upload-fix).
- Restored Cloudinary upload logic in `notes_routes.py` to fix undefined variable error (PR notes-upload-fix).
- Improved PDF handling in notes: use `resource_type='auto'`, display inline with `<iframe>` and direct download link (PR notes-pdf-view).
- Enhanced notes upload error handling and download route: validate title, catch Cloudinary errors and serve local files with `send_file` (PR notes-error-handling).
- Updated notes detail template to embed PDFs with an `<iframe>` wrapped in `.ratio`, added fallback download link and removed duplicate buttons (PR pdf-viewer-fix).

- Confirmed notes upload uses `resource_type='auto'` for Cloudinary; recommended verifying URL uses '/raw/upload' (answer to resource_type question).
- Forced Cloudinary URLs for notes to use `resource_type='raw'` when generating
  `secure_url` (PR notes-raw-url).
- Ajustado el flujo de subida de PDF a Cloudinary para almacenar `resource_type='image'` en la URL principal. Esto permite visualizar correctamente el archivo en un `<iframe>` sin bloqueos por `/raw/upload`.
- Reemplazado iframe de detalle de nota para usar Google gview y permitir visualización embebida (PR gview-iframe).
- Se integró PDF.js como visor en `detalle.html`, cargando el primer canvas con el PDF y manteniendo enlace de descarga. (PR pdfjs-viewer)
- Integrado PDF.js de forma local y configurado worker en detalle.html (PR pdfjs-local).
- Corregido el path de `pdf.worker.min.js` en `detalle.html` para que PDF.js renderice correctamente (PR pdfjs-worker-path).
- Mejorado `upload.html` para usar tarjeta Bootstrap con `form-floating` y botón primario (PR notes-upload-ui).
- Corregido include en manage_users.html eliminando 'with user=user' para evitar TemplateSyntaxError (PR manage-users-include-fix).
- Modernizado `upload.html` con tarjeta centrada y botón ancho usando Bootstrap 5 (PR notes-upload-modern-card).
- El CSP ahora permite frames desde Cloudinary (PR cloudinary-frame-src).
- Verificada presencia de PDF.js local y worker (>100KB) y correcta configuración del visor en detalle.html. CSP mantiene Cloudinary en `img-src` y `frame-src` (QA pdfjs-check).
- CSP ampliado: `connect-src` incluye Cloudinary y `script-src`/`style-src` permiten CDN (PR cloudinary-csp-connect).

- Actualizado `<header>` en `admin/partials/topbar.html` con clase `navbar-light` (PR admin-topbar-light).
- Navbar ahora usa clase `navbar-crunevo` y `navbar-expand-md`, con iconos en cada enlace (PR navbar-icons).
- Implementado input rápido en el feed para publicar texto e imagen o PDF, mostrando los últimos posts (PR feed-quick-input).
- Corregido url_for en pending.html para usar 'feed.index' y evitar BuildError (PR pending-home-link)
- Añadida sección de destacados en el feed con notas más vistas, posts populares y usuarios con logros recientes (PR featured-posts)
- Añadido ranking semanal y logros recientes en el feed (PR weekly-ranking)
- Corregidos formularios del panel de administración: `manage_users` acepta
  POST, `user_actions.html` importa `csrf_field` y envía `user_id` (PR admin-fixes)
- Fixed feed template to handle posts without an author (PR orphan-posts-fix).
- Simplified author checks in feed template using a local variable (PR feed-author-var).
- Corregido el query de usuarios destacados para agrupar por usuario y ordenar por el logro más reciente (PR top-users-orderby-fix).

- Agregado endpoint `feed.view_post` con plantilla `post_detail.html` para ver publicaciones individuales (PR post-detail-route).
- Se unificó la ruta alias de `feed.view_post` usando <int:post_id> para evitar BuildError en templates.
- Se añadió prueba unitaria para verificar el alias `/posts/<id>` de `feed.view_post` (PR view-post-alias-test).
- Verificadas rutas del feed y sin reproducir BuildError; alias '/posts/<id>' activo (QA feed-view-post-check).

- Revalidado enlace a `feed.view_post`; no se reproduce BuildError y se mantiene alias `/posts/<id>` (QA feed-view-post-check 2).
- Prueba adicional confirma url_for("feed.view_post") genera /post/<id> (QA feed-view-post-check 3).
- Endpoint `feed.view_post` se define explícitamente en la ruta y se comprueba que la blueprint está registrada (QA feed-view-post-check 4).
- Layout updated to use `container-fluid px-md-5` and sidebars distributed per page with row/col system (PR full-width-layout).
- Se corrigió la sección de destacados en feed.html usando filas y columnas Bootstrap para mostrar tarjetas en tres columnas (PR feed-layout-fix).
- Se ajustó 'feed.html' corrigiendo clases y confirmando las columnas de destacados (PR feed-layout-fix2).
- Ajustado el layout de destacados para distribuir correctamente las tarjetas en tres columnas (PR feed-layout-fix3).
- Verificada CSS global sin conflictos y la fila de destacados usa `row-cols-md-3` para asegurar las tres columnas (PR feed-layout-fix4).
- Ajustado layout de admin para separar navbar fijo y añadir padding al contenido (PR admin-spacing-fix).
- Mejorado `base_admin.html` con padding horizontal en el main y sidebar con enlaces actualizados (PR admin-spacing-fix2).
- Admin layout now uses `page` and `page-wrapper`; sidebar muestra Créditos y Estadísticas (PR admin-page-wrapper).
- Agregado bloque de noticias en el feed principal para mostrar anuncios de CRUNEVO (PR feed-news-section)
- Se añadieron likes y comentarios en las publicaciones del feed (PR feed-comments-likes)
- Panel admin rediseñado con Tabler: tema dinámico, sidebar ampliado y cards con shadow (PR admin-tabler-redesign).
- Sidebar del panel admin reorganizado con secciones y estilos para íconos alineados (PR admin-sidebar-design).
- Sidebar resalta enlace activo, toasts usan Bootstrap y topbar incluye botón de tema (PR admin-sidebar-active).
- Layout de admin en dos columnas con sidebar fijo y topbar dentro de main. Sidebar usa `nav flex-column` (PR admin-sidebar-col-fix).
- Añadido sistema de navegación de secciones por botones en el feed (PR feed-section-buttons).
- Estructura de admin modernizada con Tabler 1.3.x: sidebar fijo, topbar simplificada y soporte de tema oscuro (PR admin-modern-layout).
- Fixed like_post to initialize likes when null (PR post-like-null-fix).
- Navbar principal se oculta en /admin usando un condicional en base.html (PR admin-navbar-hide).
- Implementado filtros rápidos en el feed por query string (PR feed-quick-filters).
- Lista de apuntes ahora permite filtrar por recientes, más vistos y categorías y muestra tags en cada tarjeta (PR notes-filters).
- Apuntes admiten comentarios y reacción con likes que se pueden quitar (PR notes-comments-likes).
- Gestión de usuarios ahora incluye acciones rápidas por fila con dropdown y modal para cambiar rol (PR user-quick-actions).
- Panel de productos en admin incluye edición visual, eliminación segura y acceso directo a vista pública (PR admin-product-actions).

- Panel de administración muestra tarjetas con métricas de usuarios, apuntes, tienda, créditos y ranking (PR admin-dashboard-cards).
- Tienda actualizada con grilla Bootstrap y tarjetas con shadow en store.html y product_card.html (PR store-bootstrap-cards).
- Añadida vista de detalle de producto con ruta '/product/<id>' y enlace desde las tarjetas (PR store-product-detail).
- Carrito rediseñado con tabla responsive y controles de cantidad; nuevas rutas para modificar cantidades (PR cart-update).
- Panel de administración ahora incluye vista detallada de movimientos de créditos con tabla y razón (PR admin-credits-history).
- Panel de administración permite exportar usuarios, créditos y productos a CSV (PR admin-exports).
- En el panel de productos se corrigió el enlace a la vista pública usando `store.product_detail` (PR admin-product-link-fix).
- Eliminada la función `create_tables_once` en app.py para evitar timeouts; las tablas se gestionan con migraciones (PR app-init-fix).
- Added Fly.io troubleshooting steps for Postgres connection errors in README (PR fly-release-troubleshooting).
- Updated Fly.io docs to reference `crunevo-db.internal` (PR fly-db-internal-fix).
- Onboarding tokens now use `secrets.token_urlsafe(32)` and no longer encode the email (PR onboarding-token-length).
- Comment form listener now checks element existence with optional chaining in `detalle.html` (PR comment-form-null-check).
- Removed unused today variable from trending route in feed_routes.py (PR trending-today-remove).
- En `add_product` se castea `price` a float y `stock` a int antes de crear el producto (PR admin-add-product-cast).
- Dashboard incluye gráficas de usuarios, apuntes, créditos y productos usando Chart.js (PR admin-dashboard-charts)
- Corregido _fill_series en products_last_3_months pasando 'rows' (PR admin-stats-bugfix)
- Admin panel moved to subdomain burrito.crunevo.com with dedicated Fly app (PR admin-subdomain).
- Panel de administración aislado por completo en burrito.crunevo.com; /admin no se registra en el dominio principal y navbar público sin enlace Admin (PR admin-isolation).
- Pantalla de login exclusiva para admins en /login, redirige al dashboard y se bloquea /admin en www (PR admin-login-isolation).
- Verificada configuración ADMIN_INSTANCE=1 en fly-admin.toml y wsgi_admin.py; login redirige al dashboard y blueprint admin se registra solo en modo admin (QA admin-config-check).
- Confirmado FLASK_APP usa "crunevo.wsgi_admin:app" y create_app separa blueprints según ADMIN_INSTANCE (QA admin-env-check).
- wsgi_admin.py simplificado para importar create_app desde crunevo.app sin variables extra y se verificó FLASK_APP en fly-admin.toml (QA admin-wsgi-cleanup).

- Dockerfile now reads FLASK_APP to run gunicorn, enabling admin instance to use wsgi_admin (PR admin-gunicorn-env).
- Updated create_app to use `is_admin` flag and ensure admin blueprints load only when ADMIN_INSTANCE=1. wsgi_admin.py now sets this variable explicitly (PR admin-blueprint-filter).
- Updated wsgi.py to import create_app from crunevo.app and set FLASK_APP to 'crunevo.wsgi:app' in fly.toml to ensure Gunicorn loads the app correctly (PR wsgi-app-fix).
- Confirmed admin instance loads wsgi_admin via fly-admin.toml and blueprints register only in that mode (QA admin-deploy-fix).
- wsgi_admin.py ahora establece ADMIN_INSTANCE antes de importar create_app para evitar que el panel admin muestre el feed público (PR wsgi-admin-env-order).
- Health check blueprint registered globally and Fly admin HTTP checks configured. Added console log for instance mode (PR admin-health-check).
- Agregado PUBLIC_BASE_URL en config, context processor e enlace absoluto en manage_store para acceder a la tienda pública desde admin.
- Enlaces de perfil y productos en plantillas admin ahora usan PUBLIC_BASE_URL para apuntar al dominio público (PR admin-absolute-links2).
- Implementados logs de productos, notificaciones internas y rol de moderador con modo lectura en admin (PR admin-logs-moderator).
- Health check no redirige a HTTPS para pasar comprobaciones HTTP (PR health-check-http).
- Fixed inactive dropdowns on admin tables by initializing via main.js and adding tooltips (PR admin-dropdowns-init).
- Mejorado diseño visual del panel admin: contraste, colores y botones en modo claro/oscuro (PR admin-ui-polish).
- Sidebar dark theme polished and dropdowns reinitialized after DataTable events, with theme toggle icon updates (PR admin-dark-dropdown-fix).
- Arreglados dropdowns en tablas con getOrCreateInstance y fondo oscuro uniforme en main y tarjetas (PR admin-dropdown-dark-bg).
- Mejorados badges de rol, icono de tema, padding inferior y estilos de main según tema (PR admin-ui-accessibility-fix).
- Ajustados estilos oscuros de cards y badges, y se forzó fondo oscuro en sidebar para cubrir franjas blancas (PR admin-dark-ui-tweak).
- Dropdown de "Más opciones" ocultando tooltip activo y reinicializado tras DataTables; fondo oscuro global en body y container (PR admin-dropdown-tooltip-fix).
- Contraste de hover en el sidebar oscuro, min-height para page-content y textos muted claros; funciones de dropdowns y datatables movidas a admin_ui.js (PR admin-layout-tweak).
- Reparado dropdown de "Más opciones" en tablas admin, corrigiendo conflictos con DataTables y tooltips (PR admin-dropdown-final-fix).
- Ajustado soporte de modo oscuro en feed, apuntes y tienda (PR dark-theme-fix)
- Ensured dropdown containers use position-relative to properly render menus (QA admin-dropdown-container).
- Prevented duplicate dropdown instances by checking getInstance first (QA admin-dropdown-instance-check).
- Avoided tooltip duplication by verifying getInstance and binding show event once (QA admin-tooltip-instance-fix).
- Implemented ranking with tabs and achievements section (PR ranking-achievements).
- Integrado Resend como proveedor de emails y verificación en registro (PR resend-email-provider).
- Fixed feed weekly ranking query removing nonexistent achievement join (PR achievement-table-fix).
- Fixed profile achievements include syntax and feed loop for recent achievements (PR profile-feed-jinja-fix).
- Updated profile templates to use a.badge_code and redesigned personal profile with activity dashboard (PR profile-redesign).
- Fixed slice syntax in perfil.html loops by assigning sorted lists before slicing to avoid TemplateSyntaxError (PR profile-slice-fix).
- Registro permite subir avatar opcional y username único; perfil muestra @username y acepta nueva foto (PR profile-avatar-upload).
- Avatar por defecto se asigna automáticamente si no se sube imagen en el registro (PR default-avatar).
- Registro renovado con tarjeta responsiva, vista previa de avatar y aviso si falla Resend (PR registro-ui-email-fix).
- Implemented secure admin route to send custom emails with preview and sidebar link (PR admin-email-sender).
- Onboarding finish page redesigned with avatar file/url preview and card layout (PR onboarding-finish-ui).
- Ruta /register no se registra en la instancia admin; el registro sólo está disponible en /onboarding/register del dominio público y el login del admin sigue limitado a roles admin o moderador (PR remove-admin-register).
- Pantalla de login renovada con tarjeta doble y estilos responsive; se añadió login.css (PR login-page-redesign).
- Login page updated with transparent card and centered mobile layout (PR login-transparent-blur).
- Register page redesigned with transparent card and additional fields (PR register-redesign).
- Unified registration under /onboarding/register and removed /register route (PR register-unification).
- Login y registro comparten fondo degradado, tarjetas traslúcidas centradas y soporte de modo oscuro (PR login-register-theme).
- Se corrigió el fondo oscuro en login y registro y se actualizó el logo en login (PR login-register-dark-logo).
- Nuevo correo de confirmación con plantilla HTML y confirm_url externo; asunto actualizado (PR confirm-email-html).
- Mejorado login y registro con tarjeta translúcida, ocultar navbar, alternar contraseña y soporte móvil (PR login-register-ux).
- Optimized login and register pages with smoother theme transitions, rotating welcome phrases and accessible password toggles using 🙊/🙈 icons. Dark mode styling fixed (PR login-register-polish).
- Adjusted dark theme backgrounds to true black, improved password toggle alignment and link contrast, added fading welcome phrase rotation and disabled page scrolling (PR login-register-tweak).
- Added theme toggle button on login and register pages, refined dark mode card translucency, extended welcome phrase interval and improved link contrast (PR login-register-theme-toggle).
- Fixed dark theme backgrounds on login and register: body black, wrappers transparent, cards darker (PR login-register-dark-fix).
- Ensured gradient removed in dark mode on login and register, toggle icon updates with stored preference (PR login-register-gradient-fix).
- Corrigidos estilos de login y registro: fondo negro sólido en modo oscuro, frase estable y tema guardado en localStorage (PR login-register-stability-fix).
- Tienda actualizada: precios en soles, canje con créditos y modelo Purchase; panel admin gestiona precio_creditos y flags (PR store-credits).
- Lista de productos rediseñada con tarjetas responsive y badges; agregado store.css para estilos de tienda (PR store-layout).
- Vista de producto rediseñada con imagen grande, badges y botones (PR store-product-page).
- Corregido enlace a detalle de producto en store.html usando 'store.view_product' para evitar BuildError (PR store-detail-link-fix).
- Vista del carrito modernizada con tabla responsive, totales y botones de acción (PR cart-ui-update).
- Documentada propuesta integral de rediseño de la tienda en docs/store_proposal.md.
- Vista de tienda rediseñada completamente con panel lateral de filtros (categoría, precio, créditos), cuadrícula moderna de productos y layout limpio centrado en e-commerce educativo (PR store-redesign-ux).
- Sidebar de tienda reemplazado por menú exclusivo con enlaces de carrito, compras y filtros rápidos (PR store-sidebar).
- Ficha de producto modernizada con sección de características y stock (PR store-product-detail-redesign).
- Sistema de favoritos funcional con modelo FavoriteProduct, rutas y iconos de corazón (PR store-favorites).
- Filtros por categoría y precio habilitados en la tienda (PR store-filters).
- Historial de compras accesible en /store/compras con tarjetas de detalle y opción de descarga (PR store-purchases-page).
- Checkout real crea registros en Purchase y descuenta stock; botón "Comprar ahora" en productos (PR real-checkout).
- Corregido enlace de eliminar del carrito para usar store.remove_item y evitar BuildError (PR fix-cart-remove-link).
- Agregados alias price_paid y credits_used en Purchase, página de éxito para checkout y botones de tienda deshabilitados si no hay stock o créditos insuficientes (PR checkout-success-ui).
- Canje con créditos descuenta stock y previene duplicados usando allow_multiple; checkout desde carrito requiere confirmación (PR store-redeem-cart-checkout).
- Botón 'Más opciones' en /admin/store permite editar y eliminar productos con modal de confirmación (QA admin-store-options).
- Eliminadas duplicaciones de Bootstrap quitando tabler.min.js y moviendo modales fuera de las tablas (PR admin-dropdown-conflict-fix).
- Historial de compras permite descargar comprobante en PDF y compartir enlace; productos comprados muestran badge "Adquirido" y deshabilitan compra/canje si no se permiten duplicados. Tras comprar o canjear se ofrece descarga directa cuando hay archivo (PR purchased-badge-download).
- Corregido enlace 'Ver en tienda' en manage_store.html a /store/product/<id> para evitar redirección rota (PR admin-store-view-link-fix).
- Mejorada sección de favoritos con botones rápidos, badges y descarga integrada (PR store-favorites-actions).
- Sidebar de tienda muestra categorías dinámicas y filtros rápidos Top/Free/Pack; ruta store_index admite ?top=1, ?free=1 y ?pack=1 (PR store-sidebar-filters).
- Botón de descarga disponible en tarjetas de tienda, favoritos y página de producto si ya fue adquirido (PR store-download-btn).
- Historial de compras filtrable por fecha (7 días, mes actual, 3 meses) (PR purchases-date-filter).
- En edición de productos se sube imagen a Cloudinary y el enlace "Ver en tienda" apunta a /store/product/<id> (PR product-cloudinary-fix).
- Implementado sistema de reseñas y preguntas en productos con filtros en favoritos y visual especial para Packs (PR store-reviews-qa).
- Corregida vista de tienda para mostrar product.image_url con imagen por defecto si falta (PR store-image-url)
- Feed redesign: avatar en formulario de publicación, filtros como pestañas y fechas relativas (PR feed-v1-improved)
- Corregida plantilla store.html para usar product.image si existe, con alt y title; botón "Ver detalle" evita desbordes con tw-whitespace-nowrap (PR store-image-check)
- Added SavedPost model, donation endpoints and mobile nav.
- Añadido soporte de tema oscuro para textos grises en tarjetas del feed (PR dark-text-support).
- Feed principal reorganizado para mostrar solo publicaciones recientes con paginación básica y sin secciones de apuntes (PR feed-wall-redesign).
- Restaurado sistema de pestañas en el feed con secciones dinámicas y etiqueta "📢 Publicación" en lugar de "📝 Apunte" (PR feed-tabs-restore).
- Rediseñada página /trending con vista propia y posts ordenados por likes (PR trending-redesign)
- Vista individual de post ahora incluye botón de compartir y enlace a más publicaciones del autor; se añadió ruta feed.user_posts y se muestran 0 likes por defecto (PR post-page-share).
- Added share buttons, dynamic comments via AJAX and bottom-right toasts with Open Graph meta (PR feed-share-toasts).
- Sidebar right now highlights weekly top posts and shows achievements on mobile; posts include "Ver publicación" button and badge restyled (PR feed-highlights).
- Public profile links now use usernames, new profile page lists notes, posts and achievements, and feed posts include a "Ver perfil" button. Added user notes route (PR feed-profile-links).
- Redesigned public profile with larger avatar, achievements grid and posts/notes sections. Added /perfil/<username>/apuntes route and updated templates to use profile_by_username links (PR public-profile-redesign).
- Fixed public profile template to avoid Jinja 'with' syntax (PR profile-jinja-fix).
- Implemented basic user notification system with model, utility, routes and navbar indicator (PR notifications-basic).
- Added migration for notifications table to fix runtime errors (QA notifications-migration).

- Added quick filter sidebar on feed, PDF preview on upload form, chat messages with timestamps and notifications on comments/messages (PR feed-sidebar-chat-preview).
- Sidebar derecho unificado: apuntes, logros y ranking en una sola card; se eliminó bloque duplicado de logros en el feed (PR sidebar-right-unify).
- Removed mobile duplicate notes/achievements block from feed (PR feed-mobile-cleanup).
- Added weekly missions feature with models, routes, template and navbar link (PR missions-basic).
- Chat page now shows an 'En construcción' message and no longer provides messaging UI (PR chat-placeholder).
- Precios en store.html ahora muestran "S/ 0" cuando el producto es gratuito (PR store-free-price).

- Corrigio plantillas de tienda para usar `product.price` en lugar de `price_soles` evitando UndefinedError (PR store-price-fix).
- Se movió la sección "Últimos apuntes" del feed a /apuntes y se mejoró el sidebar con botones. Las tarjetas de apuntes cargan vista previa PDF usando PDF.js. Productos de la tienda muestran "Desde S/ 0", badge de categoría y botón de compartir (PR feed-store-pdf-preview).
- Implementado sistema completo de ranking y logros con página /ranking, asignación automática y panel admin (PR achievements-ranking-v1).
- Reestructurado el feed con sección de apuntes en la barra lateral, logros con iconos y /trending mostrando publicaciones destacadas de la semana (PR feed-restructure-notes).
- Añadido dropdown de notificaciones con actualización AJAX y botón "Marcar todo como leído" (PR dynamic-notifications).
- Mejora de subida de apuntes: admite imágenes, vista previa y spinner en el botón (PR notes-upload-preview).
- Mejorados filtros rápidos del feed con botones toggle y carga AJAX (PR feed-toggle-filters)
- Added ChatCrunevo page using OpenRouter API, shortcut /notes/populares and share link button on note detail (PR ia-chat-popular-notes).
- Feed principal limpiado quitando secciones de apuntes, logros y ranking; /notes rediseñado como catálogo con tarjetas de vista previa, filtros por likes y ruta /notes/tag/<tag> (PR notes-catalog-redesign).
- SEO meta description actualizada y ruta '/' muestra login o feed seg\u00fan autenticaci\u00f3n (PR root-login-seo-fix).
- Rediseño del feed con barra lateral de iconos, filtros móviles y tarjetas de publicaciones mejoradas (PR feed-redesign-v2).
- Feed index moved to /feed with new sidebar and post card templates (PR modern-feed).
- Corregido view_feed para retornar feed_items y sidebar derecho simplificado (PR feed-view-feed-fix).
- Navbar cleaned removing missions link and verification badge; missions now reside under /perfil with new tab and verification check shown next to usernames (PR profile-missions-verification).
- Mejorada subida de imágenes en el feed con vista previa y spinner; filtros rápidos rediseñados y se eliminó HTML obsoleto al final del feed (PR feed-todo-fix).
- Corregido tamaño del preview de imágenes, se ajustaron las publicadas y se limpiaron restos de HTML en el feed (PR feed-image-preview-fix).

- Verificada ruta view_feed y plantillas para usar solo feed_items sin apuntes extra (QA feed-view-feed-admin-check).
- Filtrado de "apuntes" en FeedItem: el feed y la API ahora omiten notas antiguas incluso para administradores (PR feed-skip-notes).
- Se añadió opción para eliminar publicaciones propias en el feed, removiendo FeedItem y cache (PR post-delete).
- Añadida funcionalidad para que los usuarios eliminen sus propios apuntes desde /notes y /perfil (PR notes-delete-user).
- Botón "Editar" agregado en publicaciones del feed con marca visual (Editado) y control de permisos (PR post-edit).
- Estilo CSS actualizado para centrar imágenes del feed y mejorar visualización móvil (PR feed-image-center).
- Se añadió botón "Reportar" en apuntes y publicaciones con modal y notificación al admin. Se habilitó ruta /notes/edit/<id> para editar título, descripción, categoría y etiquetas (PR note-edit-report).
- Sidebar de /feed/trending simplificado: solo filtros rápidos, formulario de publicación igual al feed y filtros móviles (PR trending-sidebar-cleanup).
- Ajustado ancho de detalle de apunte con container-xl y botón de descarga centrado (PR note-detail-width-fix).
- Actualizado diseño de la tienda con grilla responsiva y tarjetas con borde morado; footer incluye acciones de detalle y compartir (PR store-grid)
- Mejorado layout de tienda y favoritos usando container-fluid, textos truncados con line-clamp y tarjetas pulidas (PR store-layout-polish)
- Nombres de productos con hasta 3 líneas y tamaño 1rem; sección derecha muestra tarjetas de destacados con mensaje vacío y botón "Ver" (PR store-featured-redesign)
- Límite de 3 productos destacados con aviso en add_edit_product y verificación al guardar (PR featured-limit).
- Página de administración de tienda muestra badges de Destacado, Popular, Nuevo y Stock bajo en una columna "Etiquetas" con tooltips. Productos se ordenan por etiquetas (PR admin-store-badges-enhancement).
- Sección de destacados en la tienda convertida en carrusel horizontal con scroll y sin límite de productos (PR store-featured-carousel).
- Eliminado límite de 3 productos destacados en admin; ahora se pueden marcar todos los que se deseen (PR admin-featured-limit-removed).
- Carrusel de destacados movido antes del título de tienda y tarjetas más compactas (PR store-featured-move-reduce).
- Corrección de ordenamiento en admin/manage_store para manejar valores None (PR admin-store-sort-none-fix).
- Mejorado carrusel de destacados con tarjetas modernas, imágenes cuadradas y contenedor con sombra (PR store-featured-card-style).
- Input de imagen del feed usa id "feedImageInput" y contenedor "previewContainer" con vista previa instantánea (PR feed-image-preview-fix).
- Implementado modo oscuro en feed y tienda, scroll infinito e overlay móvil con offcanvas. Añadidas imágenes lazy (PR dark-scroll-overlay).
- Ajustado modo oscuro en tienda y feed: bg-light adaptativo, botones claros y navbar inferior con bg-body (PR dark-mode-fixes).
- Feed mejorado: filtros por categoría, buscador interno y sidebar móvil en offcanvas con botón flotante. Animaciones desactivadas en dispositivos lentos y carga infinita usando categoría. (PR feed-mobile-overlay)
- Corregido include en feed/index.html eliminando 'with categoria=categoria' para evitar TemplateSyntaxError (PR feed-sidebar-with-fix).
- Menú móvil del navbar ahora usa fondo morado con clase `offcanvas-crunevo` y los dropdowns comparten ese color. Botones flotantes de sidebar móvil cambian a icono de filtro y clase `mobile-overlay-btn` (PR overlay-menu-color).
- Tienda muestra precios en destacados, botón "+ Carrito" con AJAX y contador en el navbar y botón flotante (PR store-cart-indicators).
- Fondo del offcanvas m\xc3\xb3vil del navbar ahora cubre todo el cuerpo y enlaces permanecen en blanco; clase ajustada en navbar.html (PR offcanvas-bg-full).

- Menú móvil del navbar actualizado para cubrir toda la pantalla con fondo morado translúcido y texto legible; estilos en navbar.css. (PR mobile-offcanvas-fix)
- Menú hamburguesa y offcanvas del navbar eliminados en móviles; botones ocultos con CSS y marcado retirado. (PR remove-mobile-offcanvas)
- Navbar inferior móvil implementado con mobile_bottom_nav.html e incluido en base.html. (PR bottom-nav-mobile)
