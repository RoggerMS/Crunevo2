<!-- BaseModal Component - Reusable modal foundation -->
{% macro render_base_modal(modal_id, title, size='modal-lg', backdrop='true', keyboard='true') %}
<div class="modal fade" id="{{ modal_id }}" tabindex="-1" 
     data-bs-backdrop="{{ backdrop }}" 
     data-bs-keyboard="{{ keyboard }}" 
     aria-labelledby="{{ modal_id }}Label" 
     aria-hidden="true">
    <div class="modal-dialog {{ size }} modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-semibold" id="{{ modal_id }}Label">
                    {% block modal_title %}{{ title }}{% endblock %}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            
            <div class="modal-body pt-3">
                {% block modal_body %}
                <p class="text-muted">Contenido del modal</p>
                {% endblock %}
            </div>
            
            <div class="modal-footer border-0 pt-0">
                {% block modal_footer %}
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary">Guardar</button>
                {% endblock %}
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Confirmation Modal -->
{% macro render_confirmation_modal(modal_id, title, message, confirm_text='Confirmar', cancel_text='Cancelar', confirm_class='btn-danger') %}
<div class="modal fade" id="{{ modal_id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-semibold">{{ title }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex align-items-start gap-3">
                    <div class="flex-shrink-0">
                        <i class="bi bi-exclamation-triangle text-warning fs-3"></i>
                    </div>
                    <div>
                        <p class="mb-0">{{ message }}</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ cancel_text }}</button>
                <button type="button" class="btn {{ confirm_class }}" id="{{ modal_id }}ConfirmBtn">{{ confirm_text }}</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Loading Modal -->
{% macro render_loading_modal(modal_id, message='Procesando...') %}
<div class="modal fade" id="{{ modal_id }}" tabindex="-1" 
     data-bs-backdrop="static" 
     data-bs-keyboard="false" 
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-body text-center py-4">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mb-0 text-muted">{{ message }}</p>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- Step Modal for Multi-step Processes -->
{% macro render_step_modal(modal_id, title, steps, current_step=1) %}
<div class="modal fade" id="{{ modal_id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header border-0">
                <div class="w-100">
                    <h5 class="modal-title fw-semibold mb-3">{{ title }}</h5>
                    <!-- Step Progress -->
                    <div class="step-progress">
                        <div class="d-flex justify-content-between align-items-center">
                            {% for step in steps %}
                            <div class="step-item d-flex flex-column align-items-center {{ 'active' if loop.index == current_step else ('completed' if loop.index < current_step else '') }}">
                                <div class="step-circle">
                                    {% if loop.index < current_step %}
                                    <i class="bi bi-check"></i>
                                    {% else %}
                                    {{ loop.index }}
                                    {% endif %}
                                </div>
                                <small class="step-label mt-1">{{ step.name }}</small>
                            </div>
                            {% if not loop.last %}
                            <div class="step-connector"></div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            
            <div class="modal-body">
                {% for step in steps %}
                <div class="step-content {{ 'd-none' if loop.index != current_step else '' }}" id="step-{{ loop.index }}">
                    {% block step_content %}{{ step.content }}{% endblock %}
                </div>
                {% endfor %}
            </div>
            
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" id="prevStepBtn" {{ 'disabled' if current_step == 1 else '' }}>Anterior</button>
                <button type="button" class="btn btn-primary" id="nextStepBtn">{{ 'Finalizar' if current_step == steps|length else 'Siguiente' }}</button>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<style>
.modal-content {
    border-radius: 16px;
}

.modal-header {
    padding: 1.5rem 1.5rem 0;
}

.modal-body {
    padding: 1.5rem;
}

.modal-footer {
    padding: 0 1.5rem 1.5rem;
}

/* Step Progress Styles */
.step-progress {
    margin-bottom: 1rem;
}

.step-item {
    position: relative;
    flex: 1;
}

.step-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #e5e7eb;
    color: #6b7280;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.875rem;
    transition: all 0.3s ease;
}

.step-item.active .step-circle {
    background: #3b82f6;
    color: white;
}

.step-item.completed .step-circle {
    background: #10b981;
    color: white;
}

.step-label {
    color: #6b7280;
    font-weight: 500;
    text-align: center;
    max-width: 80px;
    line-height: 1.2;
}

.step-item.active .step-label {
    color: #3b82f6;
    font-weight: 600;
}

.step-item.completed .step-label {
    color: #10b981;
}

.step-connector {
    flex: 1;
    height: 2px;
    background: #e5e7eb;
    margin: 0 1rem;
    margin-top: 16px;
    transition: all 0.3s ease;
}

.step-item.completed + .step-connector {
    background: #10b981;
}

/* Animation for step transitions */
.step-content {
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Loading spinner customization */
.spinner-border {
    width: 3rem;
    height: 3rem;
}
</style>

<script>
// Modal utilities
window.ModalUtils = {
    show: function(modalId) {
        const modal = new bootstrap.Modal(document.getElementById(modalId));
        modal.show();
        return modal;
    },
    
    hide: function(modalId) {
        const modalElement = document.getElementById(modalId);
        const modal = bootstrap.Modal.getInstance(modalElement);
        if (modal) {
            modal.hide();
        }
    },
    
    showConfirmation: function(modalId, onConfirm) {
        const modal = this.show(modalId);
        const confirmBtn = document.getElementById(modalId + 'ConfirmBtn');
        
        const handleConfirm = () => {
            if (onConfirm) onConfirm();
            modal.hide();
            confirmBtn.removeEventListener('click', handleConfirm);
        };
        
        confirmBtn.addEventListener('click', handleConfirm);
        return modal;
    },
    
    showLoading: function(modalId, message) {
        if (message) {
            const messageElement = document.querySelector(`#${modalId} .modal-body p`);
            if (messageElement) {
                messageElement.textContent = message;
            }
        }
        return this.show(modalId);
    }
};
</script>