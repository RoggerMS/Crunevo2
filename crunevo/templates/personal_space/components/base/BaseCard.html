<!-- BaseCard Component - Reusable card foundation -->
{% macro render_base_card(card_id='', class='', style='', hover=true, shadow='shadow-sm', border=true) %}
<div class="base-card {{ class }} {{ shadow }} {{ 'card-hover' if hover else '' }} {{ 'border-0' if not border else '' }}" 
     {% if card_id %}id="{{ card_id }}"{% endif %}
     {% if style %}style="{{ style }}"{% endif %}>
    {{ caller() if caller else '' }}
</div>
{% endmacro %}

<!-- Card Header -->
{% macro render_card_header(title='', subtitle='', icon='', actions=[], class='') %}
<div class="card-header {{ class }}">
    <div class="d-flex align-items-center justify-content-between">
        <div class="card-header-content d-flex align-items-center">
            {% if icon %}
            <div class="card-icon me-3">
                <i class="bi bi-{{ icon }}"></i>
            </div>
            {% endif %}
            <div>
                {% if title %}
                <h5 class="card-title mb-0">{{ title }}</h5>
                {% endif %}
                {% if subtitle %}
                <p class="card-subtitle text-muted mb-0">{{ subtitle }}</p>
                {% endif %}
            </div>
        </div>
        
        {% if actions %}
        <div class="card-actions d-flex align-items-center gap-2">
            {% for action in actions %}
            <button type="button" 
                    class="btn {{ action.class or 'btn-outline-secondary' }} btn-sm" 
                    {% if action.onclick %}onclick="{{ action.onclick }}"{% endif %}
                    {% if action.data_attrs %}
                    {% for attr, value in action.data_attrs.items() %}
                    data-{{ attr }}="{{ value }}"
                    {% endfor %}
                    {% endif %}>
                {% if action.icon %}<i class="bi bi-{{ action.icon }} me-1"></i>{% endif %}
                {{ action.text }}
            </button>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

<!-- Card Body -->
{% macro render_card_body(class='', padding=true) %}
<div class="card-body {{ class }} {{ 'p-0' if not padding else '' }}">
    {{ caller() if caller else '' }}
</div>
{% endmacro %}

<!-- Card Footer -->
{% macro render_card_footer(class='', border=true) %}
<div class="card-footer {{ class }} {{ 'border-0' if not border else '' }}">
    {{ caller() if caller else '' }}
</div>
{% endmacro %}

<!-- Stat Card -->
{% macro render_stat_card(title, value, icon='', trend=none, trend_value='', color='primary', size='normal') %}
{% call render_base_card(class='stat-card stat-card-' + size, hover=false) %}
    {% call render_card_body() %}
        <div class="d-flex align-items-center justify-content-between">
            <div class="stat-content">
                <h3 class="stat-value text-{{ color }} mb-1">{{ value }}</h3>
                <p class="stat-title text-muted mb-0">{{ title }}</p>
                {% if trend %}
                <div class="stat-trend mt-2">
                    <span class="badge bg-{{ 'success' if trend == 'up' else 'danger' if trend == 'down' else 'secondary' }}">
                        <i class="bi bi-{{ 'arrow-up' if trend == 'up' else 'arrow-down' if trend == 'down' else 'dash' }}"></i>
                        {{ trend_value }}
                    </span>
                </div>
                {% endif %}
            </div>
            {% if icon %}
            <div class="stat-icon">
                <div class="icon-wrapper bg-{{ color }}-subtle text-{{ color }}">
                    <i class="bi bi-{{ icon }}"></i>
                </div>
            </div>
            {% endif %}
        </div>
    {% endcall %}
{% endcall %}
{% endmacro %}

<!-- Info Card -->
{% macro render_info_card(type='info', title='', message='', dismissible=false, icon='') %}
{% set type_config = {
    'info': {'color': 'info', 'icon': 'info-circle'},
    'success': {'color': 'success', 'icon': 'check-circle'},
    'warning': {'color': 'warning', 'icon': 'exclamation-triangle'},
    'danger': {'color': 'danger', 'icon': 'x-circle'}
} %}
{% set config = type_config.get(type, type_config['info']) %}

{% call render_base_card(class='info-card border-' + config.color, shadow='shadow-sm') %}
    {% call render_card_body() %}
        <div class="d-flex align-items-start">
            <div class="info-icon me-3">
                <i class="bi bi-{{ icon or config.icon }} text-{{ config.color }} fs-4"></i>
            </div>
            <div class="info-content flex-grow-1">
                {% if title %}
                <h6 class="info-title text-{{ config.color }} mb-2">{{ title }}</h6>
                {% endif %}
                <p class="info-message mb-0">{{ message }}</p>
            </div>
            {% if dismissible %}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            {% endif %}
        </div>
    {% endcall %}
{% endcall %}
{% endmacro %}

<!-- Loading Card -->
{% macro render_loading_card(message='Cargando...', height='200px') %}
{% call render_base_card(class='loading-card d-flex align-items-center justify-content-center', style='height: ' + height) %}
    <div class="text-center">
        <div class="spinner-border text-primary mb-3" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="text-muted mb-0">{{ message }}</p>
    </div>
{% endcall %}
{% endmacro %}

<!-- Empty State Card -->
{% macro render_empty_card(title='Sin datos', message='', icon='inbox', action_text='', action_onclick='') %}
{% call render_base_card(class='empty-card text-center', style='min-height: 200px;') %}
    {% call render_card_body(class='d-flex flex-column align-items-center justify-content-center') %}
        <div class="empty-icon mb-3">
            <i class="bi bi-{{ icon }} text-muted" style="font-size: 3rem;"></i>
        </div>
        <h5 class="empty-title text-muted mb-2">{{ title }}</h5>
        {% if message %}
        <p class="empty-message text-muted mb-3">{{ message }}</p>
        {% endif %}
        {% if action_text %}
        <button type="button" class="btn btn-primary" onclick="{{ action_onclick }}">
            {{ action_text }}
        </button>
        {% endif %}
    {% endcall %}
{% endcall %}
{% endmacro %}

<!-- Progress Card -->
{% macro render_progress_card(title, current, total, color='primary', show_percentage=true) %}
{% set percentage = (current / total * 100) if total > 0 else 0 %}
{% call render_base_card(class='progress-card') %}
    {% call render_card_body() %}
        <div class="d-flex align-items-center justify-content-between mb-2">
            <h6 class="progress-title mb-0">{{ title }}</h6>
            {% if show_percentage %}
            <span class="progress-percentage text-{{ color }} fw-semibold">{{ "%.0f"|format(percentage) }}%</span>
            {% endif %}
        </div>
        <div class="progress" style="height: 8px;">
            <div class="progress-bar bg-{{ color }}" 
                 role="progressbar" 
                 style="width: {{ percentage }}%" 
                 aria-valuenow="{{ current }}" 
                 aria-valuemin="0" 
                 aria-valuemax="{{ total }}">
            </div>
        </div>
        <div class="progress-details d-flex justify-content-between mt-2">
            <small class="text-muted">{{ current }} de {{ total }}</small>
            <small class="text-muted">{{ total - current }} restantes</small>
        </div>
    {% endcall %}
{% endcall %}
{% endmacro %}

<!-- Image Card -->
{% macro render_image_card(image_url, title='', description='', overlay=false, aspect_ratio='16-9') %}
{% call render_base_card(class='image-card overflow-hidden') %}
    <div class="card-img-container ratio ratio-{{ aspect_ratio }}">
        <img src="{{ image_url }}" class="card-img-top object-fit-cover" alt="{{ title }}">
        {% if overlay and (title or description) %}
        <div class="card-img-overlay d-flex flex-column justify-content-end">
            <div class="card-overlay-content">
                {% if title %}
                <h5 class="card-title text-white mb-1">{{ title }}</h5>
                {% endif %}
                {% if description %}
                <p class="card-text text-white-50 mb-0">{{ description }}</p>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
    {% if not overlay and (title or description) %}
    {% call render_card_body() %}
        {% if title %}
        <h5 class="card-title">{{ title }}</h5>
        {% endif %}
        {% if description %}
        <p class="card-text text-muted">{{ description }}</p>
        {% endif %}
    {% endcall %}
    {% endif %}
{% endcall %}
{% endmacro %}

<style>
/* Base Card Styles */
.base-card {
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    background: #ffffff;
    transition: all 0.3s ease;
    overflow: hidden;
}

.card-hover:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
}

/* Card Header */
.card-header {
    background: #f8fafc;
    border-bottom: 1px solid #e5e7eb;
    padding: 1rem 1.5rem;
}

.card-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
}

.card-subtitle {
    font-size: 0.875rem;
    color: #6b7280;
}

.card-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background: #f3f4f6;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6b7280;
    font-size: 1.25rem;
}

/* Card Body */
.card-body {
    padding: 1.5rem;
}

/* Card Footer */
.card-footer {
    background: #f8fafc;
    border-top: 1px solid #e5e7eb;
    padding: 1rem 1.5rem;
}

/* Stat Card */
.stat-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
}

.stat-card-normal .stat-value {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1;
}

.stat-card-small .stat-value {
    font-size: 1.5rem;
    font-weight: 600;
}

.stat-card-large .stat-value {
    font-size: 2.5rem;
    font-weight: 800;
}

.stat-title {
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.stat-icon .icon-wrapper {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.stat-trend .badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
}

/* Info Card */
.info-card {
    border-left-width: 4px;
}

.info-icon {
    flex-shrink: 0;
}

.info-title {
    font-weight: 600;
}

/* Loading Card */
.loading-card {
    background: #f8fafc;
}

/* Empty Card */
.empty-card {
    background: #f8fafc;
}

.empty-icon {
    opacity: 0.6;
}

/* Progress Card */
.progress {
    border-radius: 6px;
    background: #f3f4f6;
}

.progress-bar {
    border-radius: 6px;
    transition: width 0.6s ease;
}

.progress-title {
    font-weight: 600;
    color: #374151;
}

.progress-percentage {
    font-size: 0.875rem;
}

/* Image Card */
.image-card .card-img-top {
    transition: transform 0.3s ease;
}

.image-card:hover .card-img-top {
    transform: scale(1.05);
}

.card-img-overlay {
    background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 100%);
}

.card-overlay-content {
    background: rgba(0, 0, 0, 0.3);
    padding: 1rem;
    border-radius: 8px;
    backdrop-filter: blur(4px);
}

/* Color Variants */
.bg-primary-subtle {
    background-color: rgba(59, 130, 246, 0.1);
}

.bg-success-subtle {
    background-color: rgba(16, 185, 129, 0.1);
}

.bg-warning-subtle {
    background-color: rgba(245, 158, 11, 0.1);
}

.bg-danger-subtle {
    background-color: rgba(239, 68, 68, 0.1);
}

.bg-info-subtle {
    background-color: rgba(59, 130, 246, 0.1);
}

/* Responsive Design */
@media (max-width: 768px) {
    .card-header {
        padding: 1rem;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .card-footer {
        padding: 1rem;
    }
    
    .card-actions {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .card-actions .btn {
        width: 100%;
    }
    
    .stat-card .d-flex {
        flex-direction: column;
        text-align: center;
    }
    
    .stat-icon {
        margin-bottom: 1rem;
    }
}

/* Animation Classes */
.card-fade-in {
    animation: cardFadeIn 0.5s ease;
}

@keyframes cardFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card-slide-in {
    animation: cardSlideIn 0.5s ease;
}

@keyframes cardSlideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}
</style>

<script>
// Card utilities
window.CardUtils = {
    // Animate card entrance
    animateIn: function(card, animation = 'fade') {
        card.classList.add(`card-${animation}-in`);
    },
    
    // Update stat card value with animation
    updateStatValue: function(cardId, newValue, animate = true) {
        const card = document.getElementById(cardId);
        const valueElement = card?.querySelector('.stat-value');
        
        if (!valueElement) return;
        
        if (animate) {
            const currentValue = parseInt(valueElement.textContent) || 0;
            this.animateNumber(valueElement, currentValue, newValue, 1000);
        } else {
            valueElement.textContent = newValue;
        }
    },
    
    // Animate number counting
    animateNumber: function(element, start, end, duration) {
        const startTime = performance.now();
        const difference = end - start;
        
        const step = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const current = Math.floor(start + (difference * this.easeOutQuart(progress)));
            element.textContent = current;
            
            if (progress < 1) {
                requestAnimationFrame(step);
            }
        };
        
        requestAnimationFrame(step);
    },
    
    // Easing function
    easeOutQuart: function(t) {
        return 1 - Math.pow(1 - t, 4);
    },
    
    // Update progress card
    updateProgress: function(cardId, current, total) {
        const card = document.getElementById(cardId);
        const progressBar = card?.querySelector('.progress-bar');
        const percentage = card?.querySelector('.progress-percentage');
        const details = card?.querySelectorAll('.progress-details small');
        
        if (!progressBar) return;
        
        const percent = total > 0 ? (current / total * 100) : 0;
        
        progressBar.style.width = `${percent}%`;
        progressBar.setAttribute('aria-valuenow', current);
        
        if (percentage) {
            percentage.textContent = `${Math.round(percent)}%`;
        }
        
        if (details.length >= 2) {
            details[0].textContent = `${current} de ${total}`;
            details[1].textContent = `${total - current} restantes`;
        }
    },
    
    // Show/hide loading state
    setLoading: function(cardId, loading = true, message = 'Cargando...') {
        const card = document.getElementById(cardId);
        if (!card) return;
        
        if (loading) {
            const loadingHtml = `
                <div class="d-flex align-items-center justify-content-center" style="min-height: 100px;">
                    <div class="text-center">
                        <div class="spinner-border text-primary mb-2" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="text-muted mb-0">${message}</p>
                    </div>
                </div>
            `;
            card.dataset.originalContent = card.innerHTML;
            card.innerHTML = loadingHtml;
        } else {
            if (card.dataset.originalContent) {
                card.innerHTML = card.dataset.originalContent;
                delete card.dataset.originalContent;
            }
        }
    }
};
</script>