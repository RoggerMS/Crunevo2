<!-- Block Factory Modal -->
<div class="modal fade" id="block-factory-modal" tabindex="-1" aria-labelledby="blockFactoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="blockFactoryModalLabel">
                    <i class="bi bi-plus-circle me-2"></i>
                    Crear Nuevo Bloque
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Creation Mode Tabs -->
                <div class="creation-mode-tabs mb-4">
                    <div class="btn-group w-100" role="group">
                        <button type="button" class="btn btn-outline-primary creation-mode-tab active" id="individual-tab">
                            <i class="bi bi-plus-square me-2"></i>
                            Bloque Individual
                        </button>
                        <button type="button" class="btn btn-outline-primary creation-mode-tab" id="template-tab">
                            <i class="bi bi-collection me-2"></i>
                            Desde Plantilla
                        </button>
                    </div>
                </div>

                <!-- Individual Block Creation Mode -->
                <div id="individual-mode">
                    <!-- Step 1: Block Type Selection -->
                    <div class="step-content" id="step-type">
                        <div class="step-header mb-4">
                            <h6 class="step-title">Paso 1: Selecciona el tipo de bloque</h6>
                            <p class="step-description text-muted">Elige el tipo de bloque que mejor se adapte a tus necesidades</p>
                        </div>
                        
                        <div class="block-types-grid">
                            <div class="block-type-card" data-block-type="task" data-action="select-block-type">
                                <div class="block-type-icon">
                                    <i class="bi bi-check-square"></i>
                                </div>
                                <div class="block-type-info">
                                    <h6 class="block-type-title">Tareas</h6>
                                    <p class="block-type-description">Gestiona tareas y listas de pendientes</p>
                                </div>
                            </div>
                            
                            <div class="block-type-card" data-block-type="note" data-action="select-block-type">
                                <div class="block-type-icon">
                                    <i class="bi bi-journal-text"></i>
                                </div>
                                <div class="block-type-info">
                                    <h6 class="block-type-title">Notas</h6>
                                    <p class="block-type-description">Crea notas y documentos de texto</p>
                                </div>
                            </div>
                            
                            <div class="block-type-card" data-block-type="kanban" data-action="select-block-type">
                                <div class="block-type-icon">
                                    <i class="bi bi-kanban"></i>
                                </div>
                                <div class="block-type-info">
                                    <h6 class="block-type-title">Kanban</h6>
                                    <p class="block-type-description">Tableros Kanban para gestión visual</p>
                                </div>
                            </div>
                            
                            <div class="block-type-card" data-block-type="objective" data-action="select-block-type">
                                <div class="block-type-icon">
                                    <i class="bi bi-target"></i>
                                </div>
                                <div class="block-type-info">
                                    <h6 class="block-type-title">Objetivos</h6>
                                    <p class="block-type-description">Define y rastrea objetivos y metas</p>
                                </div>
                            </div>
                            
                            <div class="block-type-card" data-block-type="calendar" data-action="select-block-type">
                                <div class="block-type-icon">
                                    <i class="bi bi-calendar3"></i>
                                </div>
                                <div class="block-type-info">
                                    <h6 class="block-type-title">Calendario</h6>
                                    <p class="block-type-description">Calendario para eventos y citas</p>
                                </div>
                            </div>
                            
                            <div class="block-type-card" data-block-type="chart" data-action="select-block-type">
                                <div class="block-type-icon">
                                    <i class="bi bi-bar-chart"></i>
                                </div>
                                <div class="block-type-info">
                                    <h6 class="block-type-title">Gráficos</h6>
                                    <p class="block-type-description">Visualiza datos con gráficos</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Basic Configuration -->
                    <div class="step-content d-none" id="step-config">
                        <div class="step-header mb-4">
                            <h6 class="step-title">Paso 2: Configuración básica</h6>
                            <p class="step-description text-muted">Configura los detalles básicos de tu bloque</p>
                        </div>
                        
                        <form id="block-config-form">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group mb-3">
                                        <label for="block-title" class="form-label">Título del bloque</label>
                                        <input type="text" class="form-control" id="block-title" name="title" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        <label for="block-color" class="form-label">Color</label>
                                        <select class="form-select" id="block-color" name="color">
                                            <option value="primary">Azul</option>
                                            <option value="success">Verde</option>
                                            <option value="warning">Amarillo</option>
                                            <option value="danger">Rojo</option>
                                            <option value="info">Cian</option>
                                            <option value="secondary">Gris</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group mb-3">
                                <label for="block-description" class="form-label">Descripción (opcional)</label>
                                <textarea class="form-control" id="block-description" name="description" rows="3"></textarea>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="block-size" class="form-label">Tamaño</label>
                                        <select class="form-select" id="block-size" name="size">
                                            <option value="small">Pequeño (1x1)</option>
                                            <option value="medium" selected>Mediano (2x1)</option>
                                            <option value="large">Grande (2x2)</option>
                                            <option value="wide">Ancho (3x1)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="block-public" name="public">
                                            <label class="form-check-label" for="block-public">
                                                Hacer público
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Type-specific configuration will be loaded here -->
                            <div id="type-specific-config"></div>
                        </form>
                    </div>

                    <!-- Step 3: Preview -->
                    <div class="step-content d-none" id="step-preview">
                        <div class="step-header mb-4">
                            <h6 class="step-title">Paso 3: Vista previa</h6>
                            <p class="step-description text-muted">Revisa la configuración antes de crear el bloque</p>
                        </div>
                        
                        <div id="block-preview" class="block-preview-container">
                            <!-- Preview will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Template Mode -->
                <div id="template-mode" class="d-none">
                    <div class="template-header mb-4">
                        <h6 class="template-title">Selecciona una plantilla</h6>
                        <p class="template-description text-muted">Elige una plantilla predefinida para crear múltiples bloques de una vez</p>
                    </div>
                    
                    <!-- Template Search -->
                    <div class="template-search mb-3">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control" id="template-search" placeholder="Buscar plantillas...">
                        </div>
                    </div>
                    
                    <!-- Template Categories -->
                    <div class="template-categories mb-4">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-secondary active" data-category="all">Todas</button>
                            <button type="button" class="btn btn-outline-secondary" data-category="productivity">Productividad</button>
                            <button type="button" class="btn btn-outline-secondary" data-category="project">Proyectos</button>
                            <button type="button" class="btn btn-outline-secondary" data-category="personal">Personal</button>
                        </div>
                    </div>
                    
                    <!-- Templates Grid -->
                    <div id="templates-grid" class="templates-grid">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <div class="step-navigation">
                    <button type="button" class="btn btn-secondary" id="prev-step" style="display: none;">Anterior</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="next-step" disabled>Siguiente</button>
                    <button type="button" class="btn btn-success" id="create-block" style="display: none;">Crear Bloque</button>
                    <button type="button" class="btn btn-success" id="apply-template" style="display: none;">Aplicar Plantilla</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Basic modal initialization - all functionality is handled by BlockFactory.js
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('block-factory-modal');
    if (modal && window.BlockFactory) {
        modal.addEventListener('shown.bs.modal', function() {
            window.BlockFactory.init();
        });
        
        modal.addEventListener('hidden.bs.modal', function() {
            window.BlockFactory.reset();
        });
    }
});
</script>