<div class="nota-enriquecida-content flex flex-col h-full">
    {% set metadata = block.get_metadata() %}

    <div class="flex items-center gap-3 mb-3">
        <div class="w-8 h-8 flex items-center justify-center rounded bg-primary/10 text-primary">
            <i class="{{ metadata.get('icon', 'bi bi-file-text') }}"></i>
        </div>
        <div>
            <h6 class="m-0 font-semibold text-gray-900 dark:text-gray-100">{{ block.title or 'Nota sin título' }}</h6>
            {% if metadata.get('template_type') %}
            <span class="ml-1 text-xs px-2 py-0.5 rounded bg-emerald-100 text-emerald-600 dark:bg-emerald-800 dark:text-emerald-200">{{ metadata.get('template_type')|title }}</span>
            {% endif %}
        </div>
    </div>

    <div class="flex-1 mb-3 text-sm space-y-2">
        {% if metadata.get('blocks') %}
            {% set content_blocks = metadata.get('blocks', []) %}
            {% for content_block in content_blocks[:3] %}
                {% if content_block.type == 'heading' %}
                    <h6 class="text-sm font-semibold text-gray-900 dark:text-gray-100">{{ content_block.content[:50] }}{% if content_block.content|length > 50 %}...{% endif %}</h6>
                {% elif content_block.type == 'text' %}
                    <p class="text-sm text-gray-600 dark:text-gray-300">{{ content_block.content[:80] }}{% if content_block.content|length > 80 %}...{% endif %}</p>
                {% elif content_block.type == 'list' %}
                    <ul class="list-disc pl-4 text-sm text-gray-600 dark:text-gray-300">
                        {% for item in content_block.items[:2] %}
                        <li>{{ item[:40] }}{% if item|length > 40 %}...{% endif %}</li>
                        {% endfor %}
                        {% if content_block.items|length > 2 %}
                        <li class="text-gray-400">+{{ content_block.items|length - 2 }} más...</li>
                        {% endif %}
                    </ul>
                {% elif content_block.type == 'code' %}
                    <div class="bg-gray-100 dark:bg-gray-800 rounded px-2 py-1 font-mono text-xs overflow-hidden">
                        {{ content_block.content[:60] }}{% if content_block.content|length > 60 %}...{% endif %}
                    </div>
                {% elif content_block.type == 'quote' %}
                    <blockquote class="border-l-2 border-primary pl-3 italic text-sm text-gray-500 dark:text-gray-400">
                        {{ content_block.content[:70] }}{% if content_block.content|length > 70 %}...{% endif %}
                    </blockquote>
                {% endif %}
            {% endfor %}
            {% if content_blocks|length > 3 %}
            <div class="text-center text-xs text-gray-500">+{{ content_blocks|length - 3 }} bloques más...</div>
            {% endif %}
        {% else %}
            <div class="text-center text-gray-500 py-5">
                <i class="bi bi-plus-circle mb-2"></i>
                <p>Comienza a escribir tu nota</p>
            </div>
        {% endif %}
    </div>

    <div class="mt-auto pt-3 border-t border-gray-200 dark:border-gray-700 text-xs">
        {% if metadata.get('tags') %}
        <div class="flex flex-wrap gap-2 mb-2">
            {% for tag in metadata.get('tags', [])[:3] %}
            <span class="px-2 py-0.5 rounded bg-emerald-100 text-emerald-600 dark:bg-emerald-800 dark:text-emerald-200">{{ tag }}</span>
            {% endfor %}
            {% if metadata.get('tags')|length > 3 %}
            <span class="px-2 py-0.5 rounded bg-emerald-100 text-emerald-600 dark:bg-emerald-800 dark:text-emerald-200">+{{ metadata.get('tags')|length - 3 }}</span>
            {% endif %}
        </div>
        {% endif %}

        <div class="flex gap-4 text-gray-500 dark:text-gray-400">
            <span class="flex items-center gap-1">
                <i class="bi bi-file-text"></i>
                {{ metadata.get('blocks', [])|length }} bloques
            </span>
            <span class="flex items-center gap-1">
                <i class="bi bi-clock"></i>
                {{ block.updated_at.strftime('%d/%m') }}
            </span>
        </div>
    </div>

    <button class="btn btn-sm btn-outline-primary mt-2" onclick="openBlock({{ block.id }})">
        <i class="bi bi-pencil"></i>
        Editar nota
    </button>
</div>
