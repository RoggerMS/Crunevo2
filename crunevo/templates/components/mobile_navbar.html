<nav class="facebook-mobile-navbar d-lg-none" id="mobileNavbar">
  <a href="{{ url_for('feed.feed_home') if 'feed.feed_home' in url_for.__globals__.get('current_app', {}).view_functions else '/' }}" class="nav-icon-btn {{ 'active' if request.endpoint == 'feed.feed_home' else '' }}" aria-label="Inicio">
    <i class="bi bi-house{{ '-fill' if request.endpoint == 'feed.feed_home' else '' }}"></i>
  </a>
  <a href="{{ url_for('forum.list_questions') if 'forum.list_questions' in url_for.__globals__.get('current_app', {}).view_functions else '/foro' }}" class="nav-icon-btn {{ 'active' if 'forum' in request.endpoint else '' }}" aria-label="Explorar">
    <i class="bi bi-compass{{ '-fill' if 'forum' in request.endpoint else '' }}"></i>
  </a>
  <a href="{{ url_for('noti.ver_notificaciones') }}" class="nav-icon-btn position-relative" aria-label="Notificaciones">
    <i class="bi bi-bell"></i>
    <span id="mobileNotificationBadge" class="notification-badge position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display:none"></span>
  </a>
  <a href="{{ url_for('chat.chat_index') }}" class="nav-icon-btn" aria-label="Mensajes">
    <i class="bi bi-chat-dots"></i>
  </a>
  <div class="dropdown">
    <a href="#" class="nav-icon-btn dropdown-toggle" data-bs-toggle="dropdown" aria-label="Menú">
      {% if current_user.is_authenticated and current_user.avatar %}
        <img src="{{ current_user.avatar }}" alt="Avatar" class="profile-avatar rounded-circle">
      {% else %}
        <i class="bi bi-person-circle"></i>
      {% endif %}
    </a>
    <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 rounded-3 mt-2">
      {% if current_user.is_authenticated %}
        <li><a class="dropdown-item" href="{{ url_for('auth.perfil') }}"><i class="bi bi-person me-2"></i>Mi Perfil</a></li>
        <li><a class="dropdown-item" href="{{ url_for('notes.my_notes') if 'notes.my_notes' in url_for.__globals__.get('current_app', {}).view_functions else '/notas' }}"><i class="bi bi-journal-text me-2"></i>Mis Notas</a></li>
        <li><a class="dropdown-item" href="{{ url_for('commerce.commerce_index') if 'commerce.commerce_index' in url_for.__globals__.get('current_app', {}).view_functions else '/tienda' }}"><i class="bi bi-shop me-2"></i>Tienda</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}"><i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión</a></li>
      {% else %}
        <li><a class="dropdown-item" href="{{ url_for('auth.login') }}"><i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesión</a></li>
        <li><a class="dropdown-item" href="{{ url_for('onboarding.register') }}"><i class="bi bi-person-plus me-2"></i>Registrarse</a></li>
      {% endif %}
    </ul>
  </div>
</nav>

<style>
#mobileNavbar {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  align-items: center;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 56px;
  background: rgba(255, 255, 255, 0.95);
  z-index: 1030;
  transition: transform 0.3s ease;
}
[data-bs-theme="dark"] #mobileNavbar {
  background: rgba(36, 37, 38, 0.95);
}
body.with-mobile-navbar {
  padding-top: var(--mobile-navbar-height, 56px);
}
@media (min-width: 992px) {
  body.with-mobile-navbar {
    padding-top: 0;
  }
}
#mobileNavbar a.nav-icon-btn,
#mobileNavbar .dropdown > a {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}
.profile-avatar {
  width: 24px;
  height: 24px;
  object-fit: cover;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const navbar = document.getElementById("mobileNavbar");
  if (navbar) {
    const h = navbar.offsetHeight;
    document.body.classList.add("with-mobile-navbar");
    document.body.style.setProperty("--mobile-navbar-height", h + "px");
  }
});

let lastScroll = 0;
window.addEventListener("scroll", () => {
  const navbar = document.getElementById("mobileNavbar");
  if (!navbar) return;
  const currentScroll = window.pageYOffset;
  if (currentScroll > lastScroll && currentScroll > 50) {
    navbar.style.transform = "translateY(-100%)";
  } else {
    navbar.style.transform = "translateY(0)";
  }
  lastScroll = currentScroll;
});
</script>
