
<div class="modern-card mb-4" data-post-id="{{ post.id }}">
  <div class="card-body p-4">
    <!-- Header -->
    <div class="d-flex align-items-center mb-3">
      <div class="avatar-modern me-3">
        <img src="{{ post.user.avatar_url or url_for('static', filename='img/default.png') }}" 
             alt="Avatar de {{ post.user.username }}" 
             width="48" height="48" class="rounded-circle">
        {% if post.user.is_verified %}
        <div class="status-indicator"></div>
        {% endif %}
      </div>
      <div class="flex-grow-1">
        <div class="d-flex align-items-center gap-2">
          <a href="{{ url_for('feed.profile_by_username', username=post.user.username) }}" 
             class="fw-bold text-decoration-none">
            {{ post.user.username }}
          </a>
          {% if post.user.is_verified %}
          <i class="bi bi-patch-check-fill text-primary" title="Usuario verificado"></i>
          {% endif %}
          {% if post.user.role == 'admin' %}
          <span class="badge-modern badge-modern-danger">Admin</span>
          {% elif post.user.role == 'moderator' %}
          <span class="badge-modern badge-modern-warning">Mod</span>
          {% endif %}
        </div>
        <small class="text-muted">
          <i class="bi bi-clock me-1"></i>
          <span title="{{ post.created_at.strftime('%d/%m/%Y %H:%M') }}">
            {{ moment(post.created_at).fromNow() }}
          </span>
          {% if post.edited %}
          <span class="text-muted ms-2" title="Editado">
            <i class="bi bi-pencil-square"></i>
          </span>
          {% endif %}
        </small>
      </div>
      <div class="dropdown">
        <button class="btn btn-sm btn-outline-secondary rounded-pill" data-bs-toggle="dropdown">
          <i class="bi bi-three-dots"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li>
            <button class="dropdown-item share-btn" data-share-url="{{ url_for('feed.post_detail', id=post.id, _external=True) }}">
              <i class="bi bi-share me-2"></i>Compartir
            </button>
          </li>
          {% if current_user.is_authenticated %}
          <li>
            <a class="dropdown-item" href="#">
              <i class="bi bi-flag me-2"></i>Reportar
            </a>
          </li>
          {% if current_user.id == post.user.id or current_user.role in ['admin', 'moderator'] %}
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item text-danger" href="#">
              <i class="bi bi-trash me-2"></i>Eliminar
            </a>
          </li>
          {% endif %}
          {% endif %}
        </ul>
      </div>
    </div>

    <!-- Content -->
    <div class="mb-3">
      <p class="mb-0 lh-lg">{{ post.content|nl2br }}</p>
      {% if post.image_url %}
      <div class="mt-3">
        <img src="{{ post.image_url }}" alt="Imagen del post" 
             class="img-fluid rounded-3 shadow-sm" 
             style="max-height: 400px; width: 100%; object-fit: cover;"
             loading="lazy">
      </div>
      {% endif %}
    </div>

    <!-- Tags -->
    {% if post.tags %}
    <div class="mb-3">
      {% for tag in post.tags %}
      <a href="{{ url_for('feed.feed', tag=tag) }}" 
         class="badge-modern me-2 text-decoration-none">
        #{{ tag }}
      </a>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="d-flex align-items-center justify-content-between border-top pt-3">
      <div class="d-flex align-items-center gap-3">
        <!-- Reactions -->
        <div class="reaction-container" 
             data-post-id="{{ post.id }}" 
             data-my-reaction="{{ current_user_reaction or '' }}">
          <button class="btn btn-sm btn-outline-primary btn-reaction rounded-pill px-3">
            <span class="main-emoji">{{ most_common_reaction or '🔥' }}</span>
            <span class="count ms-1">{{ post.likes or 0 }}</span>
          </button>
          <div class="reaction-options d-none position-absolute bg-white rounded-pill shadow-lg p-2 border">
            {% for emoji in ['🔥', '❤️', '😍', '👏', '💯', '🚀'] %}
            <button class="btn btn-sm reaction-btn" data-reaction="{{ emoji }}">{{ emoji }}</button>
            {% endfor %}
          </div>
        </div>

        <!-- Comments -->
        <button class="btn btn-sm btn-outline-secondary rounded-pill px-3">
          <i class="bi bi-chat me-1"></i>
          <span>{{ post.comments.count() if post.comments else 0 }}</span>
        </button>

        <!-- Views -->
        <span class="text-muted small">
          <i class="bi bi-eye me-1"></i>{{ post.views or 0 }}
        </span>
      </div>

      <div class="d-flex align-items-center gap-2">
        <!-- Save post -->
        {% if current_user.is_authenticated %}
        <button class="btn btn-sm btn-outline-secondary rounded-circle" title="Guardar post">
          <i class="bi bi-bookmark"></i>
        </button>
        {% endif %}

        <!-- View post -->
        <a href="{{ url_for('feed.post_detail', id=post.id) }}" 
           class="btn btn-sm btn-primary rounded-pill">
          Ver post
        </a>
      </div>
    </div>

    <!-- Reaction counts -->
    {% if reaction_counts %}
    <div class="reaction-counts mt-2 small text-muted">
      {% for emoji, count in reaction_counts.items() %}
      <span class="me-2">{{ emoji }} {{ count }}</span>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>
