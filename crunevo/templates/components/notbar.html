<nav class="navbar notbar fixed-top d-lg-none text-white navbar-crunevo">
  <div class="container-fluid d-flex align-items-center justify-content-between gap-1 px-2">
    <a class="p-0" href="{{ url_for('main.index') }}" aria-label="Ir a inicio">
      <img src="{{ url_for('static', filename='img/icon-512.png') }}" alt="Crunevo" height="28" class="crunevo-logo-small">
    </a>
    <div class="flex-grow-1 position-relative mx-2">
      <input id="notbarSearch" type="search" class="form-control form-control-sm rounded-pill ps-4" placeholder="Buscar" aria-label="Campo de bÃºsqueda">
      <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-2 text-muted"></i>
    </div>
    {% from 'components/navbar_links.html' import mobile_quick_links %}
    {{ mobile_quick_links() }}
  </div>
</nav>
<script>
  const nbSearch = document.getElementById('notbarSearch');
  if (nbSearch) {
    nbSearch.addEventListener('focus', () => {
      const modalEl = document.getElementById('mobileSearchModal');
      if (modalEl) bootstrap.Modal.getOrCreateInstance(modalEl).show();
    });
  }
  
  function updateMobileNotificationBadge() {
    fetch('/notifications/api/count')
      .then(r => (r.ok ? r.json() : null))
      .then(data => {
        const count = data && typeof data.count === 'number' ? data.count : 0;
        const badge = document.getElementById('mobileNotificationBadge');
        if (badge) {
          badge.textContent = count > 0 ? count : '';
          badge.style.display = count > 0 ? 'flex' : 'none';
        }
      })
      .catch(() => {});
  }
  
  // Enhanced mobile notifications with dropdown sync
  function syncMobileNotifications() {
    const mobileList = document.getElementById('mobile-notifications-list');
    const desktopList = document.getElementById('notifications-list');
    if (mobileList && desktopList) {
      mobileList.innerHTML = desktopList.innerHTML;
    }
  }
  
  if (document.getElementById('mobileNotificationBadge')) {
    updateMobileNotificationBadge();
    syncMobileNotifications();
    setInterval(() => {
      updateMobileNotificationBadge();
      syncMobileNotifications();
    }, 30000);
  }
  
  // Optimize touch interactions for mobile navbar
  document.querySelectorAll('.notbar .btn-link').forEach(btn => {
    btn.addEventListener('touchstart', function() {
      this.style.transform = 'scale(0.95)';
    }, { passive: true });
    
    btn.addEventListener('touchend', function() {
      this.style.transform = 'scale(1)';
    }, { passive: true });
  });
</script>

