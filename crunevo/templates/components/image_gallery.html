{% macro image_gallery(images, post_id) %}
{% set count = images|length %}
{% set urls = (images | map(attribute='url') | list) if images and (images[0] is mapping or images[0].url is defined) else images %}
<div class="post-image-wrapper" data-post-id="{{ post_id }}" data-images='{{ urls | tojson }}'>
  {% if count == 1 %}
    <img src="{{ urls[0] }}" class="post-image-single" alt="Imagen 1 de la publicación" loading="lazy" onclick="openImageModal('{{ urls[0] }}', 0, '{{ post_id }}')" />
  {% elif count == 2 %}
    <div class="post-image-grid grid-cols-2 two-images">
      {% for url in urls[:2] %}
      <img src="{{ url }}" class="post-image-grid-item" alt="Imagen {{ loop.index }} de la publicación" loading="lazy" onclick="openImageModal('{{ url }}', {{ loop.index0 }}, '{{ post_id }}')" />
      {% endfor %}
    </div>
  {% elif count == 3 %}
    <div class="post-image-grid grid-cols-1-2">
      <img src="{{ urls[0] }}" class="post-image-large" alt="Imagen 1 de la publicación" loading="lazy" onclick="openImageModal('{{ urls[0] }}', 0, '{{ post_id }}')" />
      <div class="post-image-row">
        {% for url in urls[1:3] %}
        <img src="{{ url }}" class="post-image-small" alt="Imagen {{ loop.index + 1 }} de la publicación" loading="lazy" onclick="openImageModal('{{ url }}', {{ loop.index }}, '{{ post_id }}')" />
        {% endfor %}
      </div>
    </div>
  {% elif count == 4 %}
    <div class="post-image-grid grid-cols-2 four-images">
      {% for url in urls[:4] %}
      <img src="{{ url }}" class="post-image-grid-item" alt="Imagen {{ loop.index }} de la publicación" loading="lazy" onclick="openImageModal('{{ url }}', {{ loop.index0 }}, '{{ post_id }}')" />
      {% endfor %}
    </div>
  {% else %}
    <img src="{{ urls[0] }}" class="post-image-large mb-2" alt="Imagen 1 de la publicación" loading="lazy" onclick="openImageModal('{{ urls[0] }}', 0, '{{ post_id }}')" />
    <div class="post-image-grid grid-cols-3">
      <img src="{{ urls[1] }}" class="post-image-grid-item" alt="Imagen 2 de la publicación" loading="lazy" onclick="openImageModal('{{ urls[1] }}', 1, '{{ post_id }}')" />
      <img src="{{ urls[2] }}" class="post-image-grid-item" alt="Imagen 3 de la publicación" loading="lazy" onclick="openImageModal('{{ urls[2] }}', 2, '{{ post_id }}')" />
      <div class="image-thumb{% if count > 4 %} more{% endif %}" onclick="openImageModal('{{ urls[3] }}', 3, '{{ post_id }}')"{% if count > 4 %} data-more="+{{ count - 4 }}"{% endif %} role="button" tabindex="0">
        <img src="{{ urls[3] }}" class="post-image-grid-item" alt="Imagen 4 de la publicación" loading="lazy" />
      </div>
    </div>
  {% endif %}
</div>
{% endmacro %}
