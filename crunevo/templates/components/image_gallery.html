{% macro image_gallery(images, post_id) %}
{% set count = images|length %}
{% set urls = (images | map(attribute='url') | list) if images and (images[0] is mapping or images[0].url is defined) else images %}
<div class="post-image-wrapper" data-post-id="{{ post_id }}" data-images='{{ urls | tojson }}'>
  {% set url = urls[0] %}
  <img src="{{ url }}" class="post-main-image" alt="Imagen 1 de la publicaciÃ³n" loading="lazy" onclick="openImageModal('{{ url }}', 0, '{{ post_id }}')" />
  {% if count > 1 %}
  <div class="post-image-grid d-grid gap-2 mt-2" style="grid-template-columns: repeat(3, 1fr);">
    {% for url in urls[1:4] %}
    <div class="image-thumb{% if loop.last and count > 4 %} more{% endif %}" onclick="openImageModal('{{ url }}', {{ loop.index0 + 1 }}, '{{ post_id }}')"{% if loop.last and count > 4 %} data-more="+{{ count - 4 }}"{% endif %} role="button" tabindex="0">
      <img src="{{ url }}" alt="Imagen {{ loop.index + 1 }} de la publicaciÃ³n" loading="lazy" />
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endmacro %}
