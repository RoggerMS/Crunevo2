
{% macro image_gallery(images, post_id) %}
{% set count = images|length %}
{% set urls = (images | map(attribute='url') | list) if images and (images[0] is mapping or images[0].url is defined) else images %}
<div class="facebook-gallery-wrapper" data-post-id="{{ post_id }}" data-images='{{ urls | tojson }}'>
  {% if count == 1 %}
    <!-- Single image: centered, max 450px height -->
    <div class="facebook-gallery single">
      <img src="{{ urls[0] }}" 
           class="gallery-image single-image" 
           alt="Imagen 1 de {{ count }}" 
           loading="lazy" 
           onclick="openImageModal('{{ urls[0] }}', 0, '{{ post_id }}', event)"
           role="button" 
           tabindex="0" />
    </div>
  {% elif count == 2 %}
    <!-- Two images: adaptive layout based on orientation -->
    <div class="facebook-gallery two-images">
      {% for url in urls[:2] %}
      <img src="{{ url }}" 
           class="gallery-image two-image" 
           alt="Imagen {{ loop.index }} de {{ count }}" 
           loading="lazy" 
           onclick="openImageModal('{{ url }}', {{ loop.index0 }}, '{{ post_id }}', event)"
           role="button" 
           tabindex="0" />
      {% endfor %}
    </div>
  {% elif count == 3 %}
    <!-- Three images: large left + 2 small right -->
    <div class="facebook-gallery three-images">
      <img src="{{ urls[0] }}" 
           class="gallery-image large-image" 
           alt="Imagen 1 de {{ count }}" 
           loading="lazy" 
           onclick="openImageModal('{{ urls[0] }}', 0, '{{ post_id }}', event)"
           role="button" 
           tabindex="0" />
      <div class="small-images-column">
        {% for url in urls[1:3] %}
        <img src="{{ url }}" 
             class="gallery-image small-image" 
             alt="Imagen {{ loop.index + 1 }} de {{ count }}" 
             loading="lazy" 
             onclick="openImageModal('{{ url }}', {{ loop.index0 + 1 }}, '{{ post_id }}', event)"
             role="button" 
             tabindex="0" />
        {% endfor %}
      </div>
    </div>
  {% elif count == 4 %}
    <!-- Four images: 2x2 grid -->
    <div class="facebook-gallery four-images">
      {% for url in urls[:4] %}
      <img src="{{ url }}" 
           class="gallery-image grid-image" 
           alt="Imagen {{ loop.index }} de {{ count }}" 
           loading="lazy" 
           onclick="openImageModal('{{ url }}', {{ loop.index0 }}, '{{ post_id }}', event)"
           role="button" 
           tabindex="0" />
      {% endfor %}
    </div>
  {% else %}
    <!-- Five+ images: large left + 4-grid right with overlay -->
    <div class="facebook-gallery five-plus-images">
      <img src="{{ urls[0] }}"
           class="gallery-image large-image"
           alt="Imagen 1 de {{ count }}"
           loading="lazy"
           onclick="openImageModal('{{ urls[0] }}', 0, '{{ post_id }}', event)"
           role="button"
           tabindex="0" />
      <div class="small-images-grid">
        {% for url in urls[1:5] %}
        <div class="image-container {% if loop.index == 4 and count > 5 %}has-overlay{% endif %}">
          <img src="{{ url }}"
               class="gallery-image grid-image"
               alt="Imagen {{ loop.index + 1 }} de {{ count }}"
               loading="lazy"
               onclick="openImageModal('{{ url }}', {{ loop.index0 + 1 }}, '{{ post_id }}', event)"
               role="button"
               tabindex="0" />
          {% if loop.index == 4 and count > 5 %}
          <div class="image-overlay"
               onclick="openImageModal('{{ url }}', {{ loop.index0 + 1 }}, '{{ post_id }}', event)"
               role="button"
               tabindex="0">
            <span class="overlay-text">+{{ count - 5 }}</span>
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}
</div>
{% endmacro %}
