{% extends 'base.html' %}
{% import 'components/csrf.html' as csrf %}
{% block content %}
<div class="container mt-5">
  <div class="row">
    <div class="col-md-6 text-center mb-3 mb-md-0">
      <img src="{{ product.image_url or product.image }}" class="img-fluid rounded shadow" alt="{{ product.name }}">
    </div>
    <div class="col-md-6">
      <h2>{{ product.name }}</h2>
      <p class="text-muted">{{ product.description or 'Sin descripción detallada.' }}</p>
      {% if product.price_soles %}
        <p><strong>Precio: </strong><span class="text-primary">S/ {{ '%.2f' | format(product.price_soles) }}</span></p>
      {% endif %}
      {% if product.price_credits %}
        <p><strong>O por créditos: </strong><span class="text-warning">{{ product.price_credits }} créditos</span></p>
      {% endif %}
      <div class="mb-3">
        {% if product.is_new %}<span class="badge bg-success">Nuevo</span>{% endif %}
        {% if product.is_popular %}<span class="badge bg-danger">Popular</span>{% endif %}
        {% if product.credits_only %}<span class="badge bg-warning text-dark">Solo créditos</span>{% endif %}
        {% if product.is_featured %}<span class="badge bg-purple text-white">Destacado</span>{% endif %}
      </div>
      {% if product.price_credits and current_user.is_authenticated %}
      <form method="post" action="{{ url_for('store.redeem_product', product_id=product.id) }}" class="d-inline">
        {{ csrf.csrf_field() }}
        <button class="btn btn-primary me-2 mb-2" type="submit">Canjear ahora</button>
      </form>
      {% elif product.price_credits and not current_user.is_authenticated %}
      <a href="{{ url_for('auth.login') }}" class="btn btn-primary me-2 mb-2">Inicia sesión</a>
      {% endif %}
      {% if not product.credits_only %}
      <a href="{{ url_for('store.add_to_cart', product_id=product.id) }}" class="btn btn-outline-primary me-2 mb-2">Agregar al carrito</a>
      {% endif %}
      <a href="{{ url_for('store.view_cart') }}" class="btn btn-outline-success me-2 mb-2">Ver Carrito</a>
      <hr>
      <a href="{{ url_for('store.store_index') }}" class="btn btn-link">← Volver a la tienda</a>
    </div>
  </div>
</div>
{% endblock %}
