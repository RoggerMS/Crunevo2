
{% extends "base.html" %}

{% block title %}Foro Estudiantil - Crunevo{% endblock %}

{% block content %}
<div class="page-edge">
<div class="container-fluid px-3 px-lg-4 py-3">
  <!-- Modern Header with Search -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="modern-header">
        <div class="row align-items-center g-3">
          <div class="col-md-6">
            <h1 class="modern-title mb-2">üí≠ Comunidad de Estudio</h1>
            <p class="modern-subtitle mb-0">{{ stats.total_questions|number_format }} preguntas ‚Ä¢ {{ stats.solved_questions|number_format }} resueltas ‚Ä¢ {{ stats.questions_today }} hoy</p>
          </div>
          <div class="col-md-6">
            <div class="search-container">
              <form method="GET" action="{{ url_for('forum.list_questions') }}" class="search-form">
                <div class="input-group">
                  <span class="input-group-text border-0 bg-white">
                    <i class="bi bi-search text-muted"></i>
                  </span>
                  <input type="text" name="search" class="form-control border-0 shadow-none" 
                         placeholder="Buscar preguntas, temas, conceptos..." 
                         value="{{ current_search }}" aria-label="Buscar">
                  <button class="btn btn-primary modern-btn" type="submit">
                    Buscar
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Main Content -->
    <div class="col-lg-8">
      <!-- Advanced Filters & Sorting -->
      <div class="filters-panel mb-4">
        <div class="filter-header d-flex align-items-center justify-content-between mb-3">
          <h5 class="filter-title mb-0">
            <i class="bi bi-funnel me-2"></i>Filtros y Ordenamiento
          </h5>
          <button class="btn btn-link btn-sm text-decoration-none toggle-filters" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFilters">
            <i class="bi bi-chevron-down"></i>
          </button>
        </div>
        
        <div class="collapse" id="advancedFilters">
          <form method="GET" action="{{ url_for('forum.list_questions') }}" class="filter-form">
            <input type="hidden" name="search" value="{{ current_search }}">
            
            <div class="row g-3 mb-3">
              <!-- Category Filter -->
              <div class="col-md-3">
                <label class="form-label small fw-semibold">Materia</label>
                <select name="category" class="form-select form-select-sm">
                  <option value="">Todas las materias</option>
                  {% for category in categories %}
                  <option value="{{ category }}" {{ 'selected' if current_category == category }}>{{ category }}</option>
                  {% endfor %}
                </select>
              </div>
              
              <!-- Difficulty Filter -->
              <div class="col-md-3">
                <label class="form-label small fw-semibold">Dificultad</label>
                <select name="difficulty" class="form-select form-select-sm">
                  <option value="">Cualquier nivel</option>
                  {% for value, label in difficulty_levels %}
                  <option value="{{ value }}" {{ 'selected' if current_difficulty == value }}>{{ label }}</option>
                  {% endfor %}
                </select>
              </div>
              
              <!-- Grade Level Filter -->
              <div class="col-md-3">
                <label class="form-label small fw-semibold">Nivel</label>
                <select name="grade_level" class="form-select form-select-sm">
                  <option value="">Todos los niveles</option>
                  {% for value, label in grade_levels %}
                  <option value="{{ value }}" {{ 'selected' if current_grade_level == value }}>{{ label }}</option>
                  {% endfor %}
                </select>
              </div>
              
              <!-- Sort By -->
              <div class="col-md-3">
                <label class="form-label small fw-semibold">Ordenar por</label>
                <select name="sort" class="form-select form-select-sm">
                  <option value="recent" {{ 'selected' if current_sort == 'recent' }}>M√°s recientes</option>
                  <option value="popular" {{ 'selected' if current_sort == 'popular' }}>M√°s populares</option>
                  <option value="urgent" {{ 'selected' if current_sort == 'urgent' }}>Urgentes</option>
                  <option value="unanswered" {{ 'selected' if current_sort == 'unanswered' }}>Sin responder</option>
                  <option value="solved" {{ 'selected' if current_sort == 'solved' }}>Resueltas</option>
                  <option value="bounty" {{ 'selected' if current_sort == 'bounty' }}>Con recompensa</option>
                </select>
              </div>
            </div>
            
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary btn-sm">Aplicar filtros</button>
              <a href="{{ url_for('forum.list_questions') }}" class="btn btn-outline-secondary btn-sm">Limpiar</a>
            </div>
          </form>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions mb-4">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
          <div class="quick-filters d-flex gap-2 flex-wrap">
            <a href="{{ url_for('forum.list_questions', sort='urgent') }}" 
               class="badge-filter {{ 'active' if current_sort == 'urgent' }}">
              üö® Urgentes ({{ stats.urgent_questions }})
            </a>
            <a href="{{ url_for('forum.list_questions', sort='unanswered') }}" 
               class="badge-filter {{ 'active' if current_sort == 'unanswered' }}">
              ‚ùì Sin responder
            </a>
            <a href="{{ url_for('forum.list_questions', sort='bounty') }}" 
               class="badge-filter {{ 'active' if current_sort == 'bounty' }}">
              üí∞ Con recompensa
            </a>
          </div>
          
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('forum.ask_question') }}" class="btn btn-primary modern-btn">
            <i class="bi bi-plus-circle me-2"></i>Hacer pregunta
          </a>
          {% else %}
          <a href="{{ url_for('auth.login') }}" class="btn btn-outline-primary modern-btn">
            <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar sesi√≥n
          </a>
          {% endif %}
        </div>
      </div>

      <!-- Results Info -->
      {% if questions.items %}
      <div class="results-info mb-3">
        <small class="text-muted">
          Mostrando {{ questions.per_page * (questions.page - 1) + 1 }} - 
          {{ questions.per_page * (questions.page - 1) + questions.items|length }} 
          de {{ questions.total }} preguntas
          {% if current_search %}para "{{ current_search }}"{% endif %}
        </small>
      </div>
      {% endif %}

      <!-- Questions List -->
      <div class="questions-container">
        {% for question in questions.items %}
        <article class="question-card-modern" data-question-id="{{ question.id }}">
          <div class="question-card-body">
            <!-- Question Header -->
            <div class="question-header mb-3">
              <div class="d-flex align-items-start justify-content-between gap-3">
                <div class="question-meta flex-grow-1">
                  <h3 class="question-title-modern">
                    <a href="{{ url_for('forum.view_question', question_id=question.id) }}" 
                       class="question-link">{{ question.title }}</a>
                  </h3>
                  <div class="question-badges mt-2">
                    <span class="badge category-badge-{{ question.category.lower().replace('√°', 'a').replace('√≠', 'i').replace('√≥', 'o') }}">
                      {% if question.category == 'Matem√°ticas' %}üßÆ
                      {% elif question.category == 'Ciencias' %}üî¨
                      {% elif question.category == 'Lenguas' %}üìö
                      {% elif question.category == 'Historia' %}üèõÔ∏è
                      {% elif question.category == 'Tecnolog√≠a' %}üíª
                      {% elif question.category == 'Arte' %}üé®
                      {% else %}üìù
                      {% endif %}
                      {{ question.category }}
                    </span>
                    
                    {% if question.difficulty_level %}
                    <span class="badge difficulty-{{ question.difficulty_level }}">
                      {% if question.difficulty_level == 'basico' %}üü¢ B√°sico
                      {% elif question.difficulty_level == 'intermedio' %}üü° Intermedio
                      {% elif question.difficulty_level == 'avanzado' %}üî¥ Avanzado
                      {% endif %}
                    </span>
                    {% endif %}
                    
                    {% if question.is_urgent %}
                    <span class="badge urgent-badge">üö® Urgente</span>
                    {% endif %}
                    
                    {% if question.bounty_points > 0 %}
                    <span class="badge bounty-badge">üí∞ {{ question.bounty_points }} pts</span>
                    {% endif %}
                    
                    {% if question.is_solved %}
                    <span class="badge solved-badge">‚úÖ Resuelto</span>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Question Stats -->
                <div class="question-stats text-end">
                  <div class="stat-item">
                    <span class="stat-number">{{ question.answer_count }}</span>
                    <span class="stat-label">respuestas</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-number">{{ question.views }}</span>
                    <span class="stat-label">vistas</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Question Preview -->
            <div class="question-preview mb-3">
              <p class="question-excerpt">{{ question.content|striptags|truncate(150) }}</p>
            </div>

            <!-- Question Footer -->
            <div class="question-footer">
              <div class="d-flex align-items-center justify-content-between">
                <div class="author-info d-flex align-items-center">
                  {% set author = question.author %}
                  <div class="author-avatar-container me-2">
                    <img src="{{ author.avatar_url if author else url_for('static', filename='img/default.png') }}"
                         class="author-avatar" alt="Avatar">
                    {% if author and author.forum_level %}
                    <div class="level-badge">{{ author.forum_level }}</div>
                    {% endif %}
                  </div>
                  <div class="author-details">
                    <div class="author-name-container">
                      <span class="author-name">{{ author.username if author else 'Usuario eliminado' }}</span>
                      {% if author %}
                      <span class="author-rank">{{ author.get_forum_rank() }}</span>
                      {% endif %}
                    </div>
                    <div class="author-stats">
                      <span class="question-time">{{ question.created_at.strftime('%d/%m/%Y %H:%M') }}</span>
                      {% if author and author.reputation_score %}
                      <span class="reputation-score">‚Ä¢ {{ author.reputation_score }} pts</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
                
                <div class="question-actions">
                  {% if current_user.is_authenticated %}
                  <button class="action-btn bookmark-btn" data-question-id="{{ question.id }}"
                          title="Guardar pregunta">
                    <i class="bi bi-bookmark"></i>
                  </button>
                  {% endif %}
                  <button class="action-btn share-btn" title="Compartir pregunta">
                    <i class="bi bi-share"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </article>
        {% else %}
        <div class="empty-state-modern">
          <div class="empty-state-icon">üîç</div>
          <h3 class="empty-state-title">No se encontraron preguntas</h3>
          <p class="empty-state-text">
            {% if current_search or current_category or current_difficulty %}
            Intenta ajustar tus filtros de b√∫squeda o 
            <a href="{{ url_for('forum.list_questions') }}">ver todas las preguntas</a>.
            {% else %}
            ¬°S√© el primero en hacer una pregunta y comenzar la conversaci√≥n!
            {% endif %}
          </p>
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('forum.ask_question') }}" class="btn btn-primary btn-lg mt-3">
            <i class="bi bi-plus-circle me-2"></i>Hacer la primera pregunta
          </a>
          {% endif %}
        </div>
        {% endfor %}
      </div>

      <!-- Enhanced Pagination -->
      {% if questions.pages > 1 %}
      <nav class="pagination-wrapper mt-5" aria-label="Navegaci√≥n de preguntas">
        <ul class="pagination justify-content-center">
          {% if questions.has_prev %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('forum.list_questions', page=questions.prev_num, 
                search=current_search, category=current_category, difficulty=current_difficulty,
                grade_level=current_grade_level, sort=current_sort) }}">
              <i class="bi bi-chevron-left"></i>
            </a>
          </li>
          {% endif %}
          
          {% for page_num in questions.iter_pages() %}
            {% if page_num %}
              {% if page_num != questions.page %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('forum.list_questions', page=page_num,
                    search=current_search, category=current_category, difficulty=current_difficulty,
                    grade_level=current_grade_level, sort=current_sort) }}">{{ page_num }}</a>
              </li>
              {% else %}
              <li class="page-item active">
                <span class="page-link">{{ page_num }}</span>
              </li>
              {% endif %}
            {% else %}
            <li class="page-item disabled">
              <span class="page-link">‚ãØ</span>
            </li>
            {% endif %}
          {% endfor %}
          
          {% if questions.has_next %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('forum.list_questions', page=questions.next_num,
                search=current_search, category=current_category, difficulty=current_difficulty,
                grade_level=current_grade_level, sort=current_sort) }}">
              <i class="bi bi-chevron-right"></i>
            </a>
          </li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>

    <!-- Modern Sidebar -->
    <div class="col-lg-4">
      <!-- Quick Stats -->
      <div class="sidebar-card stats-card mb-4">
        <div class="sidebar-header">
          <h6 class="sidebar-title">üìä Estad√≠sticas en vivo</h6>
        </div>
        <div class="sidebar-body">
          <div class="stats-grid">
            <div class="stat-box">
              <div class="stat-value">{{ stats.total_questions|number_format }}</div>
              <div class="stat-description">Total preguntas</div>
            </div>
            <div class="stat-box">
              <div class="stat-value">{{ ((stats.solved_questions / stats.total_questions) * 100)|round|int if stats.total_questions > 0 else 0 }}%</div>
              <div class="stat-description">Tasa de resoluci√≥n</div>
            </div>
            <div class="stat-box">
              <div class="stat-value">{{ stats.questions_today }}</div>
              <div class="stat-description">Preguntas hoy</div>
            </div>
            <div class="stat-box">
              <div class="stat-value">{{ stats.urgent_questions }}</div>
              <div class="stat-description">Urgentes</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recomendaciones Personalizadas -->
      {% if current_user.is_authenticated %}
      {% include 'forum/recommendations.html' %}
      {% endif %}

      <!-- Popular Tags -->
      {% if popular_tags %}
      <div class="sidebar-card tags-card mb-4">
        <div class="sidebar-header">
          <h6 class="sidebar-title">üè∑Ô∏è Tags populares</h6>
        </div>
        <div class="sidebar-body">
          <div class="tags-cloud">
            {% for tag in popular_tags %}
            <a href="{{ url_for('forum.list_questions', tags=tag.name) }}" 
               class="tag-link" style="color: {{ tag.color }}">
              #{{ tag.name }}
            </a>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Study Tools -->
      <div class="sidebar-card tools-card mb-4">
        <div class="sidebar-header">
          <h6 class="sidebar-title">üõ†Ô∏è Herramientas de estudio</h6>
        </div>
        <div class="sidebar-body">
          <div class="tools-list">
            <a href="https://www.desmos.com/calculator" target="_blank" class="tool-link">
              <i class="bi bi-graph-up"></i>
              <span>Calculadora Gr√°fica</span>
              <i class="bi bi-box-arrow-up-right"></i>
            </a>
            <a href="https://www.symbolab.com/" target="_blank" class="tool-link">
              <i class="bi bi-calculator"></i>
              <span>Resolver Ecuaciones</span>
              <i class="bi bi-box-arrow-up-right"></i>
            </a>
            <a href="https://www.geogebra.org/" target="_blank" class="tool-link">
              <i class="bi bi-triangle"></i>
              <span>Geometr√≠a Interactiva</span>
              <i class="bi bi-box-arrow-up-right"></i>
            </a>
            <a href="https://www.wolframalpha.com/" target="_blank" class="tool-link">
              <i class="bi bi-lightning"></i>
              <span>Wolfram Alpha</span>
              <i class="bi bi-box-arrow-up-right"></i>
            </a>
          </div>
        </div>
      </div>

      <!-- Top Contributors -->
      <div class="sidebar-card leaderboard-card mb-4">
        <div class="sidebar-header">
          <h6 class="sidebar-title">üèÜ Top Contribuidores</h6>
          <a href="{{ url_for('forum.leaderboard') }}" class="view-all-link">Ver todos</a>
        </div>
        <div class="sidebar-body">
          <div class="mini-leaderboard">
            {% for user in top_contributors[:5] if top_contributors %}
            <div class="contributor-item">
              <div class="contributor-rank">#{{ loop.index }}</div>
              <div class="contributor-avatar">
                <img src="{{ user.avatar_url or url_for('static', filename='img/default.png') }}" alt="{{ user.username }}">
                <div class="level-mini-badge">{{ user.forum_level or 1 }}</div>
              </div>
              <div class="contributor-info">
                <div class="contributor-name">{{ user.username }}</div>
                <div class="contributor-stats">
                  <span class="reputation">{{ user.reputation_score or 0 }} pts</span>
                  <span class="rank-title">{{ user.get_forum_rank() if user.get_forum_rank else 'Novato' }}</span>
                </div>
              </div>
            </div>
            {% else %}
            <div class="empty-leaderboard">
              <p class="text-muted small">¬°S√© el primero en aparecer aqu√≠!</p>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Gamification CTA -->
      {% if current_user.is_authenticated %}
      <div class="sidebar-card gamification-cta mb-4">
        <div class="sidebar-body text-center">
          <div class="cta-icon">üéÆ</div>
          <h6 class="cta-title">¬°Sube de nivel!</h6>
          <p class="cta-description">Responde preguntas, gana puntos y desbloquea insignias</p>
          <a href="{{ url_for('forum.gamification_dashboard') }}" class="btn btn-primary btn-sm modern-btn">Ver mi progreso</a>
        </div>
      </div>
      {% endif %}

      <!-- Study Tips -->
      <div class="sidebar-card tips-card">
        <div class="sidebar-header">
          <h6 class="sidebar-title">üí° Consejos de estudio</h6>
        </div>
        <div class="sidebar-body">
          <div class="tips-list">
            <div class="tip-item">
              <div class="tip-icon">üìù</div>
              <div class="tip-content">
                <div class="tip-title">S√© espec√≠fico</div>
                <div class="tip-description">Incluye detalles y contexto en tus preguntas</div>
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-icon">ü§ù</div>
              <div class="tip-content">
                <div class="tip-title">Ayuda a otros</div>
                <div class="tip-description">Responder preguntas refuerza tu aprendizaje</div>
              </div>
            </div>
            <div class="tip-item">
              <div class="tip-icon">üéØ</div>
              <div class="tip-content">
                <div class="tip-title">Usa tags</div>
                <div class="tip-description">Etiqueta tus preguntas para mejor organizaci√≥n</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modern Styles -->
<style>
/* Reset and Base Styles */
.modern-header {
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  border-radius: 24px;
  padding: 2rem;
  margin-bottom: 1rem;
  border: 1px solid #e5e7eb;
}

.modern-title {
  font-size: 2rem;
  font-weight: 700;
  color: #1f2937;
  margin: 0;
}

.modern-subtitle {
  color: #6b7280;
  font-size: 0.95rem;
}

.search-container .input-group {
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.search-container .form-control {
  padding: 12px 16px;
  font-size: 1rem;
}

.modern-btn {
  border-radius: 12px;
  padding: 10px 20px;
  font-weight: 600;
  border: none;
  transition: all 0.3s ease;
}

.modern-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
}

/* Filters Panel */
.filters-panel {
  background: white;
  border-radius: 20px;
  padding: 1.5rem;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  border: 1px solid #f1f5f9;
}

.filter-title {
  color: #374151;
  font-weight: 600;
}

.form-select-sm, .form-control-sm {
  border-radius: 12px;
  border: 2px solid #e5e7eb;
  padding: 8px 12px;
}

.form-select-sm:focus, .form-control-sm:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

/* Quick Actions */
.quick-actions {
  background: white;
  border-radius: 16px;
  padding: 1rem 1.5rem;
  box-shadow: 0 2px 12px rgba(0,0,0,0.05);
  border: 1px solid #f1f5f9;
}

.badge-filter {
  display: inline-flex;
  align-items: center;
  padding: 8px 16px;
  background: #f8fafc;
  color: #64748b;
  text-decoration: none;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.badge-filter:hover, .badge-filter.active {
  background: #3b82f6;
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
}

/* Question Cards */
.question-card-modern {
  background: white;
  border-radius: 20px;
  padding: 1.5rem;
  margin-bottom: 1rem;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  border: 1px solid #f1f5f9;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.question-card-modern:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.12);
  border-color: #e2e8f0;
}

.question-title-modern {
  font-size: 1.25rem;
  font-weight: 600;
  margin: 0;
  line-height: 1.4;
}

.question-link {
  color: #1f2937;
  text-decoration: none;
  transition: color 0.3s ease;
}

.question-link:hover {
  color: #3b82f6;
}

.question-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.badge {
  font-size: 0.75rem;
  font-weight: 500;
  padding: 6px 12px;
  border-radius: 20px;
  border: none;
}

/* Category Badges */
.category-badge-matematicas { background: linear-gradient(135deg, #3b82f6, #1e40af); color: white; }
.category-badge-ciencias { background: linear-gradient(135deg, #10b981, #047857); color: white; }
.category-badge-lenguas { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
.category-badge-historia { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
.category-badge-tecnologia { background: linear-gradient(135deg, #06b6d4, #0891b2); color: white; }
.category-badge-arte { background: linear-gradient(135deg, #ec4899, #db2777); color: white; }
.category-badge-otros { background: linear-gradient(135deg, #6b7280, #4b5563); color: white; }

/* Difficulty Badges */
.difficulty-basico { background: #dcfce7; color: #166534; }
.difficulty-intermedio { background: #fef3c7; color: #92400e; }
.difficulty-avanzado { background: #fee2e2; color: #991b1b; }

/* Special Badges */
.urgent-badge { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; animation: pulse 2s infinite; }
.bounty-badge { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; }
.solved-badge { background: linear-gradient(135deg, #10b981, #059669); color: white; }

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* Question Stats */
.question-stats {
  display: flex;
  flex-direction: column;
  gap: 8px;
  min-width: 80px;
}

.stat-item {
  text-align: center;
}

.stat-number {
  display: block;
  font-size: 1.25rem;
  font-weight: 700;
  color: #3b82f6;
}

.stat-label {
  display: block;
  font-size: 0.75rem;
  color: #6b7280;
}

/* Question Preview */
.question-excerpt {
  color: #64748b;
  font-size: 0.95rem;
  line-height: 1.5;
  margin: 0;
}

/* Question Footer */
.author-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid #e5e7eb;
}

.author-name {
  font-weight: 600;
  font-size: 0.875rem;
  color: #374151;
}

.question-time {
  font-size: 0.75rem;
  color: #9ca3af;
}

.action-btn {
  background: none;
  border: none;
  padding: 8px;
  border-radius: 8px;
  color: #6b7280;
  transition: all 0.3s ease;
  cursor: pointer;
}

.action-btn:hover {
  background: #f3f4f6;
  color: #3b82f6;
}

/* Empty State */
.empty-state-modern {
  text-align: center;
  padding: 4rem 2rem;
  background: linear-gradient(135deg, #f8fafc, #e2e8f0);
  border-radius: 24px;
  border: 2px dashed #cbd5e1;
}

.empty-state-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.empty-state-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #374151;
  margin-bottom: 0.5rem;
}

.empty-state-text {
  color: #6b7280;
  font-size: 1rem;
}

/* Sidebar */
.sidebar-card {
  background: white;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  border: 1px solid #f1f5f9;
}

.sidebar-header {
  padding: 1rem 1.5rem;
  background: linear-gradient(135deg, #f8fafc, #e2e8f0);
  border-bottom: 1px solid #e5e7eb;
}

.sidebar-title {
  margin: 0;
  font-weight: 600;
  color: #374151;
}

.sidebar-body {
  padding: 1.5rem;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.stat-box {
  text-align: center;
  padding: 1rem;
  background: linear-gradient(135deg, #f8fafc, #e2e8f0);
  border-radius: 16px;
}

/* Gamification Styles */
.author-avatar-container {
  position: relative;
  display: inline-block;
}

.level-badge {
  position: absolute;
  bottom: -2px;
  right: -2px;
  background: linear-gradient(135deg, #3b82f6, #1e40af);
  color: white;
  font-size: 0.6rem;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 10px;
  border: 2px solid white;
  min-width: 18px;
  text-align: center;
}

.author-name-container {
  display: flex;
  align-items: center;
  gap: 8px;
}

.author-rank {
  font-size: 0.7rem;
  background: linear-gradient(135deg, #fbbf24, #f59e0b);
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-weight: 600;
}

.author-stats {
  display: flex;
  align-items: center;
  gap: 4px;
}

.reputation-score {
  font-size: 0.75rem;
  color: #3b82f6;
  font-weight: 600;
}

/* Leaderboard Styles */
.sidebar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.view-all-link {
  font-size: 0.8rem;
  color: #3b82f6;
  text-decoration: none;
  font-weight: 500;
}

.view-all-link:hover {
  color: #1e40af;
}

.mini-leaderboard {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.contributor-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px;
  border-radius: 12px;
  transition: background 0.3s ease;
}

.contributor-item:hover {
  background: #f8fafc;
}

.contributor-rank {
  font-weight: 700;
  color: #3b82f6;
  font-size: 0.9rem;
  min-width: 24px;
}

.contributor-avatar {
  position: relative;
}

.contributor-avatar img {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid #e5e7eb;
}

.level-mini-badge {
  position: absolute;
  bottom: -2px;
  right: -2px;
  background: linear-gradient(135deg, #3b82f6, #1e40af);
  color: white;
  font-size: 0.6rem;
  font-weight: 700;
  padding: 1px 4px;
  border-radius: 8px;
  border: 1px solid white;
  min-width: 14px;
  text-align: center;
}

.contributor-info {
  flex: 1;
  min-width: 0;
}

.contributor-name {
  font-weight: 600;
  font-size: 0.85rem;
  color: #374151;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.contributor-stats {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.reputation {
  font-size: 0.7rem;
  color: #3b82f6;
  font-weight: 600;
}

.rank-title {
  font-size: 0.65rem;
  color: #6b7280;
  font-weight: 500;
}

.empty-leaderboard {
  text-align: center;
  padding: 1rem;
}

/* Gamification CTA */
.gamification-cta {
  background: linear-gradient(135deg, #3b82f6, #1e40af);
  color: white;
}

.gamification-cta .sidebar-body {
  padding: 1.5rem;
}

.cta-icon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.cta-title {
  font-size: 1rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: white;
}

.cta-description {
  font-size: 0.85rem;
  margin-bottom: 1rem;
  opacity: 0.9;
}

.gamification-cta .modern-btn {
  background: white;
  color: #3b82f6;
  border: none;
}

.gamification-cta .modern-btn:hover {
  background: #f8fafc;
  transform: translateY(-1px);
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #3b82f6;
}

.stat-description {
  font-size: 0.75rem;
  color: #6b7280;
  margin-top: 4px;
}

/* Tags Cloud */
.tags-cloud {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.tag-link {
  display: inline-block;
  padding: 6px 12px;
  background: #f8fafc;
  border-radius: 20px;
  text-decoration: none;
  font-size: 0.875rem;
  font-weight: 500;
  transition: all 0.3s ease;
  border: 1px solid #e5e7eb;
}

.tag-link:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

/* Tools List */
.tools-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.tool-link {
  display: flex;
  align-items: center;
  padding: 12px;
  background: #f8fafc;
  border-radius: 12px;
  text-decoration: none;
  color: #374151;
  transition: all 0.3s ease;
  border: 1px solid #e5e7eb;
}

.tool-link:hover {
  background: #3b82f6;
  color: white;
  transform: translateY(-1px);
}

.tool-link i:first-child {
  margin-right: 12px;
  width: 20px;
  text-align: center;
}

.tool-link span {
  flex-grow: 1;
  font-weight: 500;
}

.tool-link i:last-child {
  opacity: 0.7;
}

/* Tips List */
.tips-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.tip-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.tip-icon {
  font-size: 1.25rem;
  width: 32px;
  text-align: center;
  flex-shrink: 0;
}

.tip-title {
  font-weight: 600;
  color: #374151;
  font-size: 0.875rem;
}

.tip-description {
  font-size: 0.75rem;
  color: #6b7280;
  margin-top: 2px;
}

/* Pagination */
.pagination-wrapper {
  display: flex;
  justify-content: center;
}

.pagination .page-link {
  border: none;
  border-radius: 12px;
  margin: 0 4px;
  color: #6b7280;
  font-weight: 600;
  padding: 12px 16px;
  transition: all 0.3s ease;
}

.pagination .page-link:hover {
  background: #3b82f6;
  color: white;
  transform: translateY(-2px);
}

.pagination .page-item.active .page-link {
  background: #3b82f6;
  border-color: #3b82f6;
}

/* Dark Mode Styles */
[data-bs-theme="dark"] {
  .modern-header {
    background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
    border-color: #4b5563;
  }

  .modern-title {
    color: #f9fafb;
  }

  .modern-subtitle {
    color: #d1d5db;
  }

  .filters-panel, .quick-actions, .question-card-modern, .sidebar-card {
    background: #1f2937;
    border-color: #4b5563;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
  }

  .filter-title, .author-name, .sidebar-title, .tip-title {
    color: #f3f4f6;
  }

  .form-select-sm, .form-control-sm {
    background-color: #374151;
    border-color: #4b5563;
    color: #f9fafb;
  }

  .form-select-sm:focus, .form-control-sm:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
  }

  .badge-filter {
    background: #374151;
    color: #d1d5db;
  }

  .badge-filter:hover, .badge-filter.active {
    background: #3b82f6;
    color: white;
  }

  .question-link {
    color: #f9fafb;
  }

  .question-link:hover {
    color: #60a5fa;
  }

  .difficulty-basico { background: #1f2937; color: #a7f3d0; border: 1px solid #34d399; }
  .difficulty-intermedio { background: #1f2937; color: #fde68a; border: 1px solid #fbbf24; }
  .difficulty-avanzado { background: #1f2937; color: #fca5a5; border: 1px solid #f87171; }

  .stat-number {
    color: #60a5fa;
  }

  .stat-label, .question-excerpt, .question-time, .tip-description, .stat-description {
    color: #9ca3af;
  }

  .author-avatar {
    border-color: #4b5563;
  }

  .action-btn {
    color: #9ca3af;
  }

  .action-btn:hover {
    background: #374151;
    color: #60a5fa;
  }

  .empty-state-modern {
    background: linear-gradient(135deg, #1f2937, #111827);
    border-color: #4b5563;
  }

  .empty-state-title {
    color: #f9fafb;
  }

  .empty-state-text {
    color: #d1d5db;
  }

  .sidebar-header {
    background: linear-gradient(135deg, #1f2937, #374151);
    border-bottom-color: #4b5563;
  }

  .stat-box {
    background: linear-gradient(135deg, #1f2937, #374151);
  }

  .tag-link {
    background: #374151;
    border-color: #4b5563;
    color: #d1d5db;
  }

  .tag-link:hover {
    background: #4b5563;
  }

  .tool-link {
    background: #374151;
    border-color: #4b5563;
    color: #d1d5db;
  }

  .tool-link:hover {
    background: #3b82f6;
    color: white;
  }

  .pagination .page-link {
    color: #9ca3af;
  }

  .pagination .page-link:hover {
    background: #3b82f6;
    color: white;
  }

  .pagination .page-item.active .page-link {
    background: #3b82f6;
    color: white;
  }
}

/* Mobile Responsive - Mobile First Approach */
@media (max-width: 576px) {
  /* Header optimizations */
  .modern-header {
    padding: 1rem;
    margin-bottom: 0.5rem;
  }
  
  .modern-title {
    font-size: 1.25rem;
    text-align: center;
  }
  
  .modern-subtitle {
    text-align: center;
    font-size: 0.85rem;
  }
  
  /* Search optimizations */
  .search-container .input-group {
    border-radius: 16px;
  }
  
  .search-container .form-control {
    padding: 10px 14px;
    font-size: 0.9rem;
  }
  
  .modern-btn {
    padding: 8px 16px;
    font-size: 0.875rem;
  }
  
  /* Filters panel mobile */
  .filters-panel {
    padding: 1rem;
    margin-bottom: 0.75rem;
  }
  
  .filter-form .row {
    gap: 0.5rem;
  }
  
  .filter-form .col-md-3 {
    margin-bottom: 0.75rem;
  }
  
  /* Quick actions mobile */
  .quick-actions {
    flex-direction: column;
    align-items: stretch;
    padding: 0.75rem 1rem;
  }
  
  .quick-filters {
    justify-content: center;
    margin-bottom: 0.75rem;
    gap: 0.5rem;
  }
  
  .badge-filter {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  /* Question cards mobile */
  .question-card-modern {
    padding: 1rem;
    margin-bottom: 0.75rem;
    border-radius: 16px;
  }
  
  .question-header {
    flex-direction: column;
    align-items: stretch;
    gap: 0.75rem;
  }
  
  .question-title-modern {
    font-size: 1.1rem;
    line-height: 1.3;
  }
  
  .question-badges {
    gap: 6px;
    margin-top: 0.5rem;
  }
  
  .badge {
    font-size: 0.7rem;
    padding: 4px 8px;
  }
  
  .question-stats {
    flex-direction: row;
    justify-content: space-around;
    margin-top: 0.75rem;
    padding: 0.5rem;
    background: #f8fafc;
    border-radius: 12px;
  }
  
  .stat-number {
    font-size: 1.1rem;
  }
  
  .stat-label {
    font-size: 0.7rem;
  }
  
  /* Question footer mobile */
  .question-footer {
    margin-top: 0.75rem;
  }
  
  .author-info {
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .author-avatar {
    width: 28px;
    height: 28px;
  }
  
  .author-name {
    font-size: 0.8rem;
  }
  
  .question-time {
    font-size: 0.7rem;
  }
  
  .question-actions {
    gap: 0.25rem;
  }
  
  .action-btn {
    padding: 6px;
    font-size: 0.875rem;
  }
  
  /* Sidebar mobile */
  .sidebar-card {
    margin-bottom: 0.75rem;
    border-radius: 16px;
  }
  
  .sidebar-header {
    padding: 0.75rem 1rem;
  }
  
  .sidebar-body {
    padding: 1rem;
  }
  
  .sidebar-title {
    font-size: 0.9rem;
  }
  
  /* Stats grid mobile */
  .stats-grid {
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
  }
  
  .stat-box {
    padding: 0.75rem 0.5rem;
    border-radius: 12px;
  }
  
  .stat-value {
    font-size: 1.1rem;
  }
  
  .stat-description {
    font-size: 0.7rem;
  }
  
  /* Leaderboard mobile */
  .contributor-item {
    padding: 6px;
    gap: 8px;
  }
  
  .contributor-avatar img {
    width: 28px;
    height: 28px;
  }
  
  .contributor-name {
    font-size: 0.8rem;
  }
  
  .reputation {
    font-size: 0.65rem;
  }
  
  .rank-title {
    font-size: 0.6rem;
  }
  
  /* Pagination mobile */
  .pagination {
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.25rem;
  }
  
  .page-link {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
  }
  
  /* Empty state mobile */
  .empty-state-modern {
    padding: 2rem 1rem;
    border-radius: 16px;
  }
  
  .empty-state-icon {
    font-size: 3rem;
  }
  
  .empty-state-title {
    font-size: 1.25rem;
  }
  
  .empty-state-text {
    font-size: 0.9rem;
  }
}

@media (max-width: 768px) and (min-width: 577px) {
  /* Tablet optimizations */
  .modern-header {
    padding: 1.5rem;
  }
  
  .modern-title {
    font-size: 1.5rem;
  }
  
  .question-card-modern {
    padding: 1.25rem;
  }
  
  .question-header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .question-stats {
    flex-direction: row;
    justify-content: space-around;
    margin-top: 1rem;
  }
  
  .stats-grid {
    grid-template-columns: 1fr 1fr;
  }
  
  .quick-actions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .quick-filters {
    justify-content: center;
    margin-bottom: 1rem;
  }
}

/* Touch-friendly improvements */
@media (hover: none) and (pointer: coarse) {
  .action-btn {
    min-height: 44px;
    min-width: 44px;
  }
  
  .badge-filter {
    min-height: 44px;
    display: inline-flex;
    align-items: center;
  }
  
  .modern-btn {
    min-height: 44px;
  }
  
  .page-link {
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
}

/* Landscape mobile optimizations */
@media (max-width: 896px) and (orientation: landscape) {
  .modern-header {
    padding: 1rem 1.5rem;
  }
  
  .question-card-modern {
    padding: 1rem 1.25rem;
  }
  
  .sidebar-card {
    margin-bottom: 0.5rem;
  }
}

/* Results info */
.results-info {
  padding: 0.5rem 1rem;
  background: #f8fafc;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Bookmark functionality
  document.querySelectorAll('.bookmark-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const questionId = this.dataset.questionId;
      
      fetch(`/foro/pregunta/${questionId}/bookmark`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.getAttribute('content') || ''
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const icon = this.querySelector('i');
          if (data.bookmarked) {
            icon.classList.remove('bi-bookmark');
            icon.classList.add('bi-bookmark-fill');
            this.style.color = '#3b82f6';
          } else {
            icon.classList.remove('bi-bookmark-fill');
            icon.classList.add('bi-bookmark');
            this.style.color = '#6b7280';
          }
        }
      })
      .catch(error => console.error('Error:', error));
    });
  });
  
  // Share functionality
  document.querySelectorAll('.share-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const questionCard = this.closest('.question-card-modern');
      const questionLink = questionCard.querySelector('.question-link');
      const url = questionLink.href;
      const title = questionLink.textContent;
      
      if (navigator.share) {
        navigator.share({
          title: title,
          url: url
        });
      } else {
        navigator.clipboard.writeText(url).then(() => {
          // Show a temporary tooltip
          const tooltip = document.createElement('div');
          tooltip.textContent = '¬°Enlace copiado!';
          tooltip.style.cssText = `
            position: absolute;
            background: #374151;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            z-index: 1000;
            pointer-events: none;
          `;
          document.body.appendChild(tooltip);
          
          const rect = this.getBoundingClientRect();
          tooltip.style.top = (rect.top - 40) + 'px';
          tooltip.style.left = (rect.left + rect.width/2 - tooltip.offsetWidth/2) + 'px';
          
          setTimeout(() => {
            document.body.removeChild(tooltip);
          }, 2000);
        });
      }
    });
  });
  
  // Auto-submit form on filter change
  document.querySelectorAll('.filter-form select').forEach(select => {
    select.addEventListener('change', function() {
      this.closest('form').submit();
    });
  });
  
  // Smooth scroll for internal links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
});
</script>
{% endblock %}
