{% extends 'admin/base_admin.html' %}
{% block admin_content %}
<h2 class="page-title mb-4">Gestión de usuarios</h2>
<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table id="tablaUsuarios" class="table table-vcenter card-table">
      <thead>
        <tr>
          <th>Nombre</th><th>Email</th><th>Rol</th>
          <th>Créditos</th><th>Estado</th><th></th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td><span class="badge bg-{{ 'purple' if user.role == 'admin' else 'blue' }}">{{ 'Admin' if user.role == 'admin' else 'Estudiante' }}</span></td>
          <td>{{ user.credits }}</td>
          <td>
            <span class="status-dot status-dot-{{ 'green' if user.activated else 'red' }}"></span>
          </td>
          <td class="text-end">
            <div class="dropdown">
              <button class="btn btn-sm btn-light dropdown-toggle" data-bs-toggle="dropdown">
                ⋮
              </button>
              <ul class="dropdown-menu shadow-sm">
                <li><a class="dropdown-item" href="{{ url_for('auth.public_profile', user_id=user.id) }}" target="_blank">Ver perfil público</a></li>
                <li><button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#editRoleModal{{ user.id }}">Cambiar rol</button></li>
                <li><a class="dropdown-item text-warning" href="{{ url_for('admin.toggle_user_status', user_id=user.id) }}">Suspender / Reactivar</a></li>
                <li><a class="dropdown-item text-muted" href="{{ url_for('admin.user_activity', user_id=user.id) }}">Ver actividad</a></li>
              </ul>
            </div>
          </td>
        </tr>
        {% include 'admin/modals/user_actions.html' %}
        {% include 'admin/modals/edit_role.html' %}
        {% endfor %}
      </tbody>
      </table>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  new simpleDatatables.DataTable('#tablaUsuarios');
});
</script>
{% endblock %}
