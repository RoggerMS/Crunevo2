<div class="position-sticky pt-3 nav flex-column">
  <span class="text-muted fw-bold small mb-2">🧑 Administración</span>
  <a class="nav-link {% if request.endpoint == 'admin.dashboard' %}active{% endif %}" href="{{ url_for('admin.dashboard') }}">
    <i class="ti ti-layout-dashboard me-2"></i> Dashboard
  </a>
  <a class="nav-link {% if request.endpoint == 'admin.manage_users' %}active{% endif %}" href="{{ url_for('admin.manage_users') }}">
    <i class="ti ti-users me-2"></i> Gestión de usuarios
  </a>
  <a class="nav-link {% if request.endpoint == 'admin.manage_reports' %}active{% endif %}" href="{{ url_for('admin.manage_reports') }}">
    <i class="ti ti-flag me-2"></i> Reportes
    {% if URGENT_REPORTS %}
      <span class="badge bg-danger ms-1">{{ URGENT_REPORTS }}</span>
    {% endif %}
  </a>
  <a class="nav-link {% if request.endpoint == 'admin.admin_logs' %}active{% endif %}" href="{{ url_for('admin.admin_logs') }}">
    <i class="ti ti-clipboard-list me-2"></i> Auditoría
  </a>
  <a class="nav-link {% if request.endpoint == 'admin.manage_store' %}active{% endif %}" href="{{ url_for('admin.manage_store') }}">
    <i class="ti ti-building-store me-2"></i> Tienda
  </a>
  <a class="nav-link {% if request.endpoint == 'admin.product_history' %}active{% endif %}" href="{{ url_for('admin.product_history') }}">
    <i class="ti ti-history me-2"></i> Historial tienda
  </a>
  {% if 'admin.stats_page' in url_for.__globals__.get('current_app', {}).view_functions %}
  <a class="nav-link {% if request.endpoint == 'admin.stats_page' %}active{% endif %}" href="{{ url_for('admin.stats_page') }}">
    <i class="ti ti-chart-bar me-2"></i> Estadísticas
  </a>
  <a class="nav-link {% if request.endpoint == 'admin.pageviews' %}active{% endif %}" href="{{ url_for('admin.pageviews') }}">
    <i class="ti ti-chart-heatmap me-2"></i> Pageviews
  </a>
  {% endif %}
  <a class="nav-link {% if request.endpoint == 'admin.manage_credits' %}active{% endif %}" href="{{ url_for('admin.manage_credits') }}">
    <i class="ti ti-coin me-2"></i> Crolars
  </a>
  <a class="nav-link {% if request.endpoint == 'admin.manage_prints' %}active{% endif %}" href="{{ url_for('admin.manage_prints') }}">
    <i class="ti ti-printer me-2"></i> Impresiones
  </a>
  <a class="nav-link {% if request.endpoint == 'admin_email.send_admin_email' %}active{% endif %}" href="{{ url_for('admin_email.send_admin_email') }}">
    <i class="ti ti-mail me-2"></i> Enviar correo
  </a>

  <span class="text-muted fw-bold small mt-4 mb-2">🏅 Comunidad</span>
  <a class="nav-link {% if request.endpoint == 'admin.verification_requests' %}active{% endif %}" href="{{ url_for('admin.verification_requests') }}">
    <i class="ti ti-check me-2"></i> Verificaciones
  </a>
  <a class="nav-link {% if request.endpoint == 'admin.pending_comments' %}active{% endif %}" href="{{ url_for('admin.pending_comments') }}">
    <i class="ti ti-message me-2"></i> Comentarios pendientes
  </a>
  {% if 'admin.manage_achievements' in url_for.__globals__.get('current_app', {}).view_functions %}
  <a class="nav-link {% if request.endpoint == 'admin.manage_achievements' %}active{% endif %}" href="{{ url_for('admin.manage_achievements') }}">
    <i class="ti ti-award me-2"></i> Logros
  </a>
  {% endif %}
  <a class="nav-link {% if request.endpoint == 'admin.manage_missions' %}active{% endif %}" href="{{ url_for('admin.manage_missions') }}">
    <i class="ti ti-target me-2"></i> Misiones
  </a>
  <a class="nav-link disabled"><i class="ti ti-calendar-event me-2"></i> Eventos</a>

  <span class="text-muted fw-bold small mt-4 mb-2">🔧 Sistema</span>
  <a class="nav-link" href="#" onclick="showSystemStatus()">
    <i class="ti ti-server me-2"></i> Estado del Sistema
  </a>
  <a class="nav-link" href="#" onclick="showBackupStatus()">
    <i class="ti ti-database me-2"></i> Backup
  </a>
  <a class="nav-link" href="#" onclick="showCacheStatus()">
    <i class="ti ti-speed me-2"></i> Cache
  </a>
  <a class="nav-link" href="#" onclick="showErrorLogs()">
    <i class="ti ti-bug me-2"></i> Logs de Error
  </a>

  <span class="text-muted fw-bold small mt-4 mb-2">📊 Analytics</span>
  <a class="nav-link" href="#" onclick="showUserAnalytics()">
    <i class="ti ti-chart-line me-2"></i> Analytics Usuarios
  </a>
  <a class="nav-link" href="#" onclick="showContentAnalytics()">
    <i class="ti ti-chart-pie me-2"></i> Analytics Contenido
  </a>
  <a class="nav-link" href="#" onclick="showCommerceAnalytics()">
    <i class="ti ti-shopping-cart me-2"></i> Analytics Tienda
  </a>
  <a class="nav-link" href="#" onclick="showPerformanceMetrics()">
    <i class="ti ti-gauge me-2"></i> Métricas Rendimiento
  </a>

  <span class="text-muted fw-bold small mt-4 mb-2">⚙️ Configuración</span>
  <a class="nav-link" href="#" onclick="showSiteSettings()">
    <i class="ti ti-settings me-2"></i> Configuración Sitio
  </a>
  <a class="nav-link" href="#" onclick="showEmailSettings()">
    <i class="ti ti-mail-cog me-2"></i> Configuración Email
  </a>
  <a class="nav-link" href="#" onclick="showSecuritySettings()">
    <i class="ti ti-shield me-2"></i> Configuración Seguridad
  </a>
  <a class="nav-link" href="#" onclick="showMaintenanceSettings()">
    <i class="ti ti-tools me-2"></i> Configuración Mantenimiento
  </a>

  <div class="mt-4 pt-3 border-top">
    <div class="d-flex align-items-center mb-2">
      <div class="bg-success rounded-circle me-2" style="width: 8px; height: 8px;"></div>
      <small class="text-muted">Sistema Online</small>
    </div>
    <small class="text-muted d-block">{{ current_user.username }}</small>
    <small class="text-muted d-block">{{ current_user.role|title }}</small>
  </div>
</div>

<!-- Modales para funcionalidades avanzadas -->
<div class="modal fade" id="systemStatusModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Estado del Sistema</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="systemStatusContent">
        <div class="text-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="analyticsModal" tabindex="-1">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="analyticsModalTitle">Analytics</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="analyticsContent">
        <div class="text-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function showSystemStatus() {
  const modal = new bootstrap.Modal(document.getElementById('systemStatusModal'));
  modal.show();
  
  fetch('/admin/api/system-metrics')
    .then(response => response.json())
    .then(data => {
      document.getElementById('systemStatusContent').innerHTML = `
        <div class="row">
          <div class="col-md-6">
            <h6>Métricas del Sistema</h6>
            <div class="mb-3">
              <label class="form-label">CPU</label>
              <div class="progress">
                <div class="progress-bar bg-primary" style="width: ${data.cpu_percent}%">${data.cpu_percent}%</div>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Memoria</label>
              <div class="progress">
                <div class="progress-bar bg-success" style="width: ${data.memory_percent}%">${data.memory_percent}%</div>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Disco</label>
              <div class="progress">
                <div class="progress-bar bg-warning" style="width: ${data.disk_percent}%">${data.disk_percent}%</div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <h6>Alertas del Sistema</h6>
            ${data.alerts && data.alerts.length > 0 ? 
              data.alerts.map(alert => `
                <div class="alert alert-${alert.severity === 'critical' ? 'danger' : 'warning'} alert-sm">
                  <i class="bi bi-exclamation-triangle me-2"></i>
                  ${alert.message}
                </div>
              `).join('') : 
              '<div class="alert alert-success alert-sm">No hay alertas activas</div>'
            }
          </div>
        </div>
      `;
    });
}

function showUserAnalytics() {
  const modal = new bootstrap.Modal(document.getElementById('analyticsModal'));
  document.getElementById('analyticsModalTitle').textContent = 'Analytics de Usuarios';
  modal.show();
  
  fetch('/admin/api/analytics?days=30')
    .then(response => response.json())
    .then(data => {
      document.getElementById('analyticsContent').innerHTML = `
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h6>Métricas de Usuarios</h6>
                <ul class="list-unstyled">
                  <li><strong>Nuevos usuarios:</strong> ${data.users.new_users}</li>
                  <li><strong>Usuarios activos:</strong> ${data.users.active_users}</li>
                  <li><strong>Tasa de crecimiento:</strong> ${data.users.growth_rate.toFixed(2)}%</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h6>Métricas de Contenido</h6>
                <ul class="list-unstyled">
                  <li><strong>Nuevos apuntes:</strong> ${data.content.new_notes}</li>
                  <li><strong>Nuevos posts:</strong> ${data.content.new_posts}</li>
                  <li><strong>Total likes:</strong> ${data.content.total_likes}</li>
                  <li><strong>Total comentarios:</strong> ${data.content.total_comments}</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `;
    });
}

function showContentAnalytics() {
  const modal = new bootstrap.Modal(document.getElementById('analyticsModal'));
  document.getElementById('analyticsModalTitle').textContent = 'Analytics de Contenido';
  modal.show();
  
  fetch('/admin/api/analytics?days=30')
    .then(response => response.json())
    .then(data => {
      document.getElementById('analyticsContent').innerHTML = `
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-body">
                <h6>Análisis de Contenido</h6>
                <div class="row">
                  <div class="col-md-3">
                    <div class="text-center">
                      <h4 class="text-primary">${data.content.new_notes}</h4>
                      <small class="text-muted">Apuntes</small>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="text-center">
                      <h4 class="text-success">${data.content.new_posts}</h4>
                      <small class="text-muted">Posts</small>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="text-center">
                      <h4 class="text-warning">${data.content.total_likes}</h4>
                      <small class="text-muted">Likes</small>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="text-center">
                      <h4 class="text-info">${data.content.total_comments}</h4>
                      <small class="text-muted">Comentarios</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    });
}

function showCommerceAnalytics() {
  const modal = new bootstrap.Modal(document.getElementById('analyticsModal'));
  document.getElementById('analyticsModalTitle').textContent = 'Analytics de Tienda';
  modal.show();
  
  fetch('/admin/api/analytics?days=30')
    .then(response => response.json())
    .then(data => {
      document.getElementById('analyticsContent').innerHTML = `
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-body">
                <h6>Métricas de Comercio</h6>
                <div class="row">
                  <div class="col-md-4">
                    <div class="text-center">
                      <h4 class="text-primary">${data.commerce.total_purchases}</h4>
                      <small class="text-muted">Compras</small>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="text-center">
                      <h4 class="text-success">S/ ${data.commerce.total_revenue.toFixed(2)}</h4>
                      <small class="text-muted">Ingresos</small>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="text-center">
                      <h4 class="text-warning">S/ ${data.commerce.avg_order_value.toFixed(2)}</h4>
                      <small class="text-muted">Valor Promedio</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    });
}

function showPerformanceMetrics() {
  const modal = new bootstrap.Modal(document.getElementById('analyticsModal'));
  document.getElementById('analyticsModalTitle').textContent = 'Métricas de Rendimiento';
  modal.show();
  
  fetch('/admin/api/real-time')
    .then(response => response.json())
    .then(data => {
      document.getElementById('analyticsContent').innerHTML = `
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-body">
                <h6>Datos en Tiempo Real</h6>
                <div class="row">
                  <div class="col-md-4">
                    <div class="text-center">
                      <h4 class="text-primary">${data.active_users}</h4>
                      <small class="text-muted">Usuarios Activos</small>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="text-center">
                      <h4 class="text-success">${data.recent_notes}</h4>
                      <small class="text-muted">Apuntes Recientes</small>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="text-center">
                      <h4 class="text-warning">${data.recent_posts}</h4>
                      <small class="text-muted">Posts Recientes</small>
                    </div>
                  </div>
                </div>
                <small class="text-muted">Actualizado: ${new Date(data.timestamp).toLocaleString()}</small>
              </div>
            </div>
          </div>
        </div>
      `;
    });
}

function showBackupStatus() {
  alert('Función de backup en desarrollo');
}

function showCacheStatus() {
  alert('Función de cache en desarrollo');
}

function showErrorLogs() {
  alert('Función de logs en desarrollo');
}

function showSiteSettings() {
  alert('Función de configuración en desarrollo');
}

function showEmailSettings() {
  alert('Función de email en desarrollo');
}

function showSecuritySettings() {
  alert('Función de seguridad en desarrollo');
}

function showMaintenanceSettings() {
  alert('Función de mantenimiento en desarrollo');
}
</script>
