{% extends 'base.html' %}
{% import 'components/csrf.html' as csrf %}
{% block content %}
<h2>Mi perfil</h2>
<div class="mb-3 text-center">
  <img src="{{ current_user.avatar_url or url_for('static', filename='img/default.png') }}" class="rounded-circle" width="100" height="100" alt="avatar">
  <p class="mt-2">{{ current_user.username }}
  {% if current_user.role == 'moderator' %}
    <span class="badge text-bg-secondary">Modo lectura</span>
  {% endif %}
  </p>
  <p>💰 Créditos: {{ current_user.credits }}</p>
</div>
<form method="post" class="tw-space-y-4">
  {{ csrf.csrf_field() }}
  <div>
    <textarea class="tw-rounded tw-border tw-border-gray-300 dark:tw-border-gray-700 tw-w-full tw-px-3 tw-py-2 focus:tw-ring-2 focus:tw-ring-[var(--primary)] focus:tw-outline-none" name="about" placeholder="Sobre mí">{{ current_user.about }}</textarea>
  </div>
  <div>
    <input type="text" class="tw-rounded tw-border tw-border-gray-300 dark:tw-border-gray-700 tw-w-full tw-px-3 tw-py-2 focus:tw-ring-2 focus:tw-ring-[var(--primary)] focus:tw-outline-none" name="avatar_url" placeholder="URL del avatar" value="{{ current_user.avatar_url }}">
  </div>
  <button class="tw-rounded tw-bg-[var(--primary)] tw-text-white tw-px-4 tw-py-2 tw-transition tw-duration-200 hover:tw-bg-[var(--primary)]/80" type="submit">Guardar</button>
</form>
<h5>Historial de Créditos</h5>
<ul>
  {% for c in current_user.credit_history %}
    <li>{{ '+' if c.amount > 0 else '' }}{{ c.amount }} – {{ c.reason }} ({{ c.timestamp.strftime('%Y-%m-%d') }})</li>
  {% endfor %}
</ul>
<h5>Logros desbloqueados</h5>
<ul>
  {% for a in current_user.achievements %}
    <li>🏅 {{ a.badge_code.replace("_", " ").capitalize() }} ({{ a.earned_at.strftime('%Y-%m-%d') }})</li>
  {% else %}
    <li>Aún no tienes logros desbloqueados.</li>
  {% endfor %}
</ul>
{% endblock %}

