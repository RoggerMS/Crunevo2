{% import 'components/csrf.html' as csrf %}
<h3 class="mb-3">üéØ Tus misiones activas</h3>

{% for mision in misiones %}
  {% set progreso = progresos.get(mision.id) %}
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">{{ mision.description }}</h5>
      <small class="text-muted">Meta: {{ mision.goal }} ‚Ä¢ Recompensa: +{{ mision.credit_reward }} cr√©ditos</small><br>
      {% if progreso %}
        <progress value="{{ progreso.progreso }}" max="{{ mision.goal }}"></progress>
        <p>Progreso: {{ progreso.progreso }}/{{ mision.goal }}</p>
        {% if progreso.completada and not progreso.reclamada %}
          <form method="post" action="{{ url_for('missions.reclamar_mision', mission_id=mision.id) }}">
            {{ csrf.csrf_field() }}
            <button class="btn btn-success btn-sm mt-2">üéÅ Reclamar cr√©ditos</button>
          </form>
        {% elif progreso.reclamada %}
          <span class="badge bg-primary mt-2">Ya reclamada</span>
        {% else %}
          <span class="badge bg-secondary mt-2">‚ùå Pendiente</span>
        {% endif %}
      {% else %}
        <progress value="0" max="{{ mision.goal }}"></progress>
        <p>Progreso: 0/{{ mision.goal }}</p>
      {% endif %}
    </div>
  </div>
{% else %}
  <p>No hay misiones disponibles a√∫n.</p>
{% endfor %}
